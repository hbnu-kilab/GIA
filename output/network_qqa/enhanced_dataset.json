[
  {
    "id": "ENHANCED_ENHANCED-SCENARIO-001",
    "question": "고객사 A의 L3VPN 간헐적 단절의 근본 원인을 식별하라. BGP 세션 불안정(미싱/플랩)인지, 아니면 VRF가 일부 PE에서 올바르게 바인딩/RT가 유효하지 않아 라우트가 유실되는지 증거를 모아 판단하라.",
    "context": "BGP 설정 현황:\nCE1: AS65001, 1개 피어\nCE2: AS65003, 1개 피어\nsample10: AS65000, 3개 피어\nsample7: AS65000, 3개 피어\nsample8: AS65000, 3개 피어",
    "ground_truth": "원인 미확인",
    "explanation": "제공된 증거에서 ibgp_missing_pairs_count 값이 0이므로 iBGP 누락이나 BGP 세션의 미싱/플랩과 같은 BGP 세션 불안정은 확인되지 않습니다. 또한 vrf_rt_list_per_device가 '없음'으로 보고되어 VRF가 일부 PE에서 바인딩되지 않거나 RT가 유효하지 않아 라우트가 유실되는 문제도 발견되지 않습니다. 따라서 주어진 데이터만으로는 근본 원인을 특정할 수 없으므로 추가 조사가 필요합니다. 추가 조사로는 시간대별 BGP 업데이트/로그와 플랩 기록 확인, PE별 RIB/FIB(VPN 라우트 존재 여부) 점검, BFD 및 PE-CE 링크 상태 확인, MPLS 라벨 분배(LDP/RSVP) 상태 확인, 관련 시점의 패킷 캡처 및 컨트롤플레인 리소스(CPU/메모리) 모니터링을 권장합니다.",
    "answer_type": "short",
    "category": "advanced",
    "complexity": "scenario",
    "level": 4,
    "persona": "troubleshooter",
    "scenario": "장애 상황 대응",
    "source_files": [
      "ce1.xml",
      "ce2.xml",
      "sample10.xml",
      "sample7.xml",
      "sample8.xml",
      "sample9.xml"
    ],
    "metadata": {
      "origin": "enhanced_llm_with_agent",
      "reasoning_plan": [
        {
          "required_metric": "ibgp_missing_pairs_count",
          "metric_params": {
            "host": "PE1"
          }
        },
        {
          "required_metric": "vrf_rt_list_per_device",
          "metric_params": {
            "host": "PE1",
            "vrf": "CustA-VRF"
          }
        },
        {
          "intent": "show_vrf",
          "params": {
            "host": "PE1",
            "vrf": "CustA-VRF"
          }
        },
        {
          "intent": "show_bgp_summary",
          "params": {
            "host": "PE1"
          }
        },
        {
          "intent": "check_connectivity",
          "params": {
            "src": "PE1",
            "dst": "CE1"
          }
        }
      ],
      "reasoning_requirement": "",
      "expected_analysis_depth": "detailed",
      "evidence": {
        "step_None_ibgp_missing_pairs_count": 0,
        "step_None_vrf_rt_list_per_device": []
      }
    }
  },
  {
    "id": "ENHANCED_ENHANCED-SCENARIO-002",
    "question": "PE3를 추가한 이후 특정 L3VPN 경로가 보이지 않거나 광고되지 않는 경우, 로컬 AS 설정 오류, eBGP 피어링의 원격 AS 불일치, 또는 누락된 route-map이 원인인지 판별하고 우선 원인으로 단정할 수 있는 증거를 제시하라.",
    "context": "BGP 설정 현황:\nCE1: AS65001, 1개 피어\nCE2: AS65003, 1개 피어\nsample10: AS65000, 3개 피어\nsample7: AS65000, 3개 피어\nsample8: AS65000, 3개 피어",
    "ground_truth": "누락된 route-map",
    "explanation": "제공된 증거에서 bgp_local_as_numeric이 0으로 나타나므로 PE3의 로컬 AS 구성 오류는 배제할 수 있습니다. ebgp_remote_as_map이 빈 객체({})로 나타나는 것은 eBGP 피어의 원격 AS 불일치가 감지되지 않았음을 의미하므로 원격 AS 불일치 역시 주원인으로 보기 어렵습니다. 따라서 남는 합리적인 원인은 route-map의 누락 또는 잘못된 적용으로, 이는 경로가 수신되거나 광고되는 것을 차단할 수 있습니다. 문제를 확정하려면 PE3의 BGP 이웃 구성에서 neighbor ... route-map 문구의 존재 여부와 route-map의 permit/deny 및 match/set 구성을 확인해야 합니다.",
    "answer_type": "short",
    "category": "advanced",
    "complexity": "scenario",
    "level": 4,
    "persona": "troubleshooter",
    "scenario": "장애 상황 대응",
    "source_files": [
      "ce1.xml",
      "ce2.xml",
      "sample10.xml",
      "sample7.xml",
      "sample8.xml",
      "sample9.xml"
    ],
    "metadata": {
      "origin": "enhanced_llm_with_agent",
      "reasoning_plan": [
        {
          "required_metric": "bgp_local_as_numeric",
          "metric_params": {
            "host": "PE3"
          }
        },
        {
          "required_metric": "ebgp_remote_as_map",
          "metric_params": {
            "host": "PE3"
          }
        },
        {
          "intent": "show_bgp_neighbors",
          "params": {
            "host": "PE3"
          }
        },
        {
          "intent": "show_bgp_neighbor_detail",
          "params": {
            "host": "PE3",
            "neighbor": "PE2"
          }
        },
        {
          "intent": "show_route_table",
          "params": {
            "host": "PE3",
            "vrf": "CustA-VRF"
          }
        }
      ],
      "reasoning_requirement": "",
      "expected_analysis_depth": "detailed",
      "evidence": {
        "step_None_bgp_local_as_numeric": 0,
        "step_None_ebgp_remote_as_map": {}
      }
    }
  },
  {
    "id": "ENHANCED_ENHANCED-SCENARIO-003",
    "question": "ibgp_missing_pairs(3개)가 있을 때, 어떤 VRF(또는 고객)가 영향을 받을지 파악하고, 그 영향이 전역(다수 고객)인지 특정 고객에 국한되는지 분석하라.",
    "context": "BGP 설정 현황:\nCE1: AS65001, 1개 피어\nCE2: AS65003, 1개 피어\nsample10: AS65000, 3개 피어\nsample7: AS65000, 3개 피어\nsample8: AS65000, 3개 피어",
    "ground_truth": "판단 불가 — ibgp_missing_pairs 항목이 보고되지 않았으므로(데이터 없음) 영향을 받는 VRF(고객)과 그 범위(전역/특정)를 결정할 수 없습니다.",
    "explanation": "제공된 증거에는 ibgp_missing_pairs, vrf_names_set, vrf_rt_list_per_device 항목이 모두 '없음'으로 표시되어 있어 어떤 iBGP 페어가 누락되었는지, 누가 그 페어를 사용하는지, 그리고 해당 세션이 어떤 주소가족(예: VPNv4/IPv4-VRF)을 전달하는지 확인할 수 없습니다. 일반적으로 누락된 iBGP 페어의 영향 범위는 다음과 같이 판단합니다: (1) 해당 페어가 라우트 리플렉터와 클라이언트 사이거나 VPNv4 등을 전달하는 세션이면 다수의 VRF(여러 고객)에 전역적으로 영향을 줄 수 있습니다. (2) 반대로 페어가 특정 VRF 전용의 PE 간 세션이거나 VRF별로 분리된 세션이면 특정 고객에 국한된 영향일 수 있습니다. 현재 증거로는 위 두 경우 중 어느 쪽인지 판정할 수 없으므로, 영향을 식별하려면 누락된 iBGP 페어의 구체적 목록(피어 IP/디바이스), 해당 페어의 주소가족 및 역할(라리트 리플렉터/클라이언트 여부), 그리고 디바이스별 VRF→RT 매핑(또는 vrf_rt_list_per_device)을 추가로 수집해야 합니다.",
    "answer_type": "short",
    "category": "advanced",
    "complexity": "scenario",
    "level": 4,
    "persona": "troubleshooter",
    "scenario": "장애 상황 대응",
    "source_files": [
      "ce1.xml",
      "ce2.xml",
      "sample10.xml",
      "sample7.xml",
      "sample8.xml",
      "sample9.xml"
    ],
    "metadata": {
      "origin": "enhanced_llm_with_agent",
      "reasoning_plan": [
        {
          "required_metric": "ibgp_missing_pairs",
          "metric_params": {
            "host": "PE1"
          }
        },
        {
          "required_metric": "vrf_names_set",
          "metric_params": {
            "host": "PE1"
          }
        },
        {
          "required_metric": "vrf_rt_list_per_device",
          "metric_params": {
            "host": "PE2"
          }
        },
        {
          "intent": "show_route_table",
          "params": {
            "host": "PE2",
            "vrf": "CustA-VRF"
          }
        },
        {
          "intent": "show_bgp_summary",
          "params": {
            "host": "PE2"
          }
        }
      ],
      "reasoning_requirement": "",
      "expected_analysis_depth": "detailed",
      "evidence": {
        "step_None_ibgp_missing_pairs": [],
        "step_None_vrf_names_set": [],
        "step_None_vrf_rt_list_per_device": []
      }
    }
  },
  {
    "id": "ENHANCED_ENHANCED-SCENARIO-004",
    "question": "발견된 L2VPN 문제(2건)가 L3VPN 서비스에 직접적인 영향(데이터 플레인 단절)인지, 아니면 경로/광고 문제(제어 플레인)에 국한되는지 확인하라. 양측을 구분할 증거를 제시하라.",
    "context": "VRF 설정 현황:\nsample10: 1개 VRF (exam-l3vpn)\nsample7: 1개 VRF (exam-l3vpn)\nsample8: 1개 VRF (exam-l3vpn)\nsample9: 1개 VRF (exam-l3vpn)",
    "ground_truth": "control_plane_only",
    "explanation": "The evidence points to a control-plane (path/advertisement) issue rather than a direct L3VPN data-plane outage. There are no l2vpn_unidirectional_pairs reported, which indicates no observed unidirectional L2 forwarding failures that would signal an active data-plane disruption. The two findings are l2vpn_pwid_mismatch_pairs between sample7 and sample9 (both directions), which is a pseudowire ID/configuration mismatch and is characteristic of signaling or configuration asymmetry in the L2VPN control plane. A PWID mismatch prevents proper pseudowire establishment or advertisement but does not by itself prove that L3VPN packet forwarding is broken. To be certain, one should still verify L3VPN reachability (MP-BGP status, VRF route presence, and end-to-end ping/traceroute across the VPN) because if an L3VPN relies on the affected L2 pseudowire as its underlying transport, an unresolved PWID mismatch could indirectly disrupt L3 traffic. Based on the provided evidence alone, however, the issue is limited to the control plane (path/advertisement) rather than a direct L3VPN data-plane outage.",
    "answer_type": "short",
    "category": "advanced",
    "complexity": "scenario",
    "level": 4,
    "persona": "troubleshooter",
    "scenario": "장애 상황 대응",
    "source_files": [
      "ce1.xml",
      "ce2.xml",
      "sample10.xml",
      "sample7.xml",
      "sample8.xml",
      "sample9.xml"
    ],
    "metadata": {
      "origin": "enhanced_llm_with_agent",
      "reasoning_plan": [
        {
          "required_metric": "l2vpn_unidirectional_pairs",
          "metric_params": {
            "host": "P1"
          }
        },
        {
          "required_metric": "l2vpn_pwid_mismatch_pairs",
          "metric_params": {
            "host": "P1"
          }
        },
        {
          "intent": "show_l2vpn_vc",
          "params": {
            "host": "P1",
            "vc": "vc-CustA"
          }
        },
        {
          "intent": "show_l2vpn_status",
          "params": {
            "host": "P1"
          }
        },
        {
          "intent": "check_connectivity",
          "params": {
            "src": "CE1",
            "dst": "CE1",
            "via_vrf": "CustA-VRF"
          }
        }
      ],
      "reasoning_requirement": "",
      "expected_analysis_depth": "detailed",
      "evidence": {
        "step_None_l2vpn_unidirectional_pairs": [],
        "step_None_l2vpn_pwid_mismatch_pairs": [
          "sample7<->sample9",
          "sample9<->sample7"
        ]
      }
    }
  },
  {
    "id": "ENHANCED_ENHANCED-SCENARIO-005",
    "question": "제안된 route-map(set_bgp_routemap)을 PE2에 적용하려고 할 때, 어떤 부작용(특정 고객의 경로 소실, 트래픽 루프 등)이 발생할 수 있는지 시나리오별로 검증 절차와 함께 제시하라.",
    "context": "BGP 설정 현황:\nCE1: AS65001, 1개 피어\nCE2: AS65003, 1개 피어\nsample10: AS65000, 3개 피어\nsample7: AS65000, 3개 피어\nsample8: AS65000, 3개 피어",
    "ground_truth": [
      {
        "scenario_id": 1,
        "situation": "route-map가 BGP next-hop을 PE2 또는 접근 불가 주소로 설정함",
        "potential_side_effects": [
          "특정 고객(또는 일부 프리픽스)의 경로 소실(경로가 설치되지 않음)",
          "트래픽 루프(다른 경로가 PE2로 돌아오며 순환 발생 가능)"
        ],
        "verification_steps": [
          "show route-map set_bgp_routemap",
          "show ip bgp <affected-prefix> detail",
          "show ip bgp vpnv4 vrf <VRF-name> <affected-prefix>",
          "show ip bgp neighbors <peer-ip> advertised-routes",
          "show ip route <next-hop> || ping <next-hop> from PE2",
          "traceroute from CE toward destination and from PE2 toward CE to detect loops",
          "debug ip bgp updates (주의: 영향 확인 후 사용)"
        ]
      },
      {
        "scenario_id": 2,
        "situation": "route-map가 community/route-target을 설정하여 상위(또는 인근) 라우터의 필터 정책을 트리거함",
        "potential_side_effects": [
          "특정 고객의 VPNv4/vpnv6 경로가 다른 PE/AS로 전달되지 않거나 필터되어 소실됨",
          "타 고객 트래픽이 잘못된 대상으로 유입되어 서비스 장애"
        ],
        "verification_steps": [
          "show route-map set_bgp_routemap",
          "show ip bgp vpnv4 vrf <VRF-name> community",
          "show ip bgp neighbors <peer-ip> received-community",
          "show ip bgp <prefix> community",
          "show run | include route-target || show ip vrf detail",
          "검증용 CE-CE ping/traceroute (CE에서 목적지 도달 여부 확인)",
          "capture/packet-trace(필요시)로 community가 부착되어 전송되는지 확인"
        ]
      },
      {
        "scenario_id": 3,
        "situation": "route-map가 local-preference/weight/med 값을 변경하여 경로 선호도가 바뀜",
        "potential_side_effects": [
          "트래픽 경로가 의도치 않게 다른 PE/포인트로 전환되어 비대칭 라우팅 또는 과부하 발생",
          "특정 고객 트래픽이 검증되지 않은 경로로 유입되어 성능 저하 또는 패킷 손실"
        ],
        "verification_steps": [
          "show ip bgp vpnv4 vrf <VRF-name> <prefix> attributes",
          "show ip bgp vpnv4 <prefix> bestpath",
          "show ip route <prefix> vrf <VRF-name>",
          "show ip bgp neighbors <peer> routes | include weight|localpref|metric",
          "span/monitor 트래픽 엔지니어링 지점에서 트래픽량 확인",
          "CE에서의 traceroute 및 throughput 테스트"
        ]
      },
      {
        "scenario_id": 4,
        "situation": "route-map가 AS-path를 수정(AS prepend/AS strip)하거나 origin을 변경함",
        "potential_side_effects": [
          "경로 선택이 다른 AS로 편향되어 특정 고객 경로가 차단되거나 루프 발생",
          "경로 플랩/경로 불안정성(경로 재선택 빈번)"
        ],
        "verification_steps": [
          "show ip bgp <prefix> as-path",
          "show ip bgp neighbors <peer> received-routes",
          "show ip bgp vpnv4 vrf <VRF-name> <prefix> detail",
          "debug bgp events/updates(주의하여 사용)",
          "모니터링 시스템에서 BGP 경로 변경 로그 확인"
        ]
      },
      {
        "scenario_id": 5,
        "situation": "route-map가 VRF 관련 RD/RT 또는 MP-BGP 속성을 변경하여 import/export 동작을 깨뜨림",
        "potential_side_effects": [
          "VPN 경로가 특정 VRF에 임포트되지 않아 고객에게 보이지 않음(경로 소실)",
          "다른 VRF로 잘못 임포트되어 보안/트래픽 혼재 발생"
        ],
        "verification_steps": [
          "show ip bgp vpnv4 vrf <VRF-name> | include Route-Distinguisher|route-target",
          "show bgp vpnv4 all labels",
          "show ip route vrf <VRF-name>",
          "show ip bgp vpnv4 vrf <VRF-name> <prefix> detail",
          "verify RT/RT import/export 정책(정책문서 및 device config 확인)"
        ]
      },
      {
        "scenario_id": 6,
        "situation": "route-map의 match/deny 규칙이 과도하게 넓어 다수 프리픽스를 차단함(실수로 deny all 등)",
        "potential_side_effects": [
          "여러 고객의 경로 대량 소실",
          "서비스 중단 및 복구 시 긴 재수렴 시간"
        ],
        "verification_steps": [
          "show route-map set_bgp_routemap",
          "show ip bgp summary",
          "show ip bgp vpnv4 vrf <VRF-name> | include prefixes",
          "compare BGP prefix counts(before/after 적용)",
          "simulate route-map 적용 전후의 advertise/receive behavior(test lab if possible)",
          "rollback 계획 및 적용 전 staged 테스트"
        ]
      }
    ],
    "explanation": "각 시나리오에서 제안된 부작용은 route-map가 BGP 경로의 핵심 속성(next-hop, community, local-preference, AS-path, RD/RT 등)을 변경하거나 부적절하게 매칭/거부할 때 발생합니다. 시나리오 1에서 next-hop을 PE2 또는 도달 불가능한 주소로 설정하면 해당 경로의 next-hop 검증에 실패하여 라우터가 경로를 설치하지 않거나, 설치되더라도 트래픽이 되돌아와 루프를 형성할 수 있습니다. 따라서 next-hop의 도달성(ping)과 BGP 테이블에서의 next-hop 값 및 광고 정보를 확인하는 것이 유효한 검증 방법입니다. 시나리오 2에서는 community 혹은 route-target이 상위·이웃 장비의 필터 정책을 트리거하여 경로가 필터되어 사라질 수 있으므로, 전파된 community와 VRF의 import/export 상태를 확인하고 CE 간 통신으로 실제 서비스 가용성을 검증해야 합니다. 시나리오 3의 속성 변경(local-pref, weight, MED)은 경로 선호도를 바꿔 트래픽을 다른 방향으로 몰아 비대칭 라우팅 또는 과부하를 야기하므로 BGP의 베스트패스 속성과 RIB/FIB 간의 일치를 비교하고 실제 트래픽 플로우를 측정하여 검증해야 합니다. 시나리오 4는 AS-path나 origin 변경으로 경로 선택 순위가 바뀌며, 때로는 루프나 경로 불안정을 유발하므로 as-path를 확인하고 BGP 업데이트 로그를 모니터링하여 이상 징후를 잡아야 합니다. 시나리오 5는 MPLS/VPN 환경에서 RD/RT나 MP-BGP 속성 변경이 VRF간 import/export를 깨뜨려 고객 경로가 보이지 않게 만들 수 있으므로 VPNv4 라우트 디테일과 RT 설정을 반드시 검증해야 합니다. 마지막으로 시나리오 6은 route-map의 매치/deny 구성이 광범위하게 잘못되면 다수 프리픽스가 차단되어 대량 장애를 유발하므로, 적용 전후의 prefix 카운트 비교와 테스트 랩에서의 시뮬레이션, 적용 시점의 롤백 계획을 준비해야 합니다. 제시한 verification 단계들은 각 속성 변경이 BGP 테이블, VRF RIB/FIB, 실제 트래픽 경로에 어떤 영향을 주는지를 직접 확인할 수 있는 명령과 절차들로 구성되어 있어, 문제 발생 여부를 신속히 탐지하고 원인을 규명하는 데 적합합니다.",
    "answer_type": "long",
    "category": "advanced",
    "complexity": "scenario",
    "level": 4,
    "persona": "troubleshooter",
    "scenario": "장애 상황 대응",
    "source_files": [],
    "metadata": {
      "origin": "enhanced_llm_with_agent",
      "reasoning_plan": [
        {
          "intent": "show_bgp_summary",
          "params": {
            "host": "PE2"
          }
        },
        {
          "intent": "show_bgp_neighbors",
          "params": {
            "host": "PE2"
          }
        },
        {
          "intent": "set_bgp_routemap",
          "params": {
            "host": "PE2",
            "routemap": "FILTER-CustA",
            "direction": "in"
          }
        },
        {
          "intent": "show_route_table",
          "params": {
            "host": "PE2",
            "vrf": "CustA-VRF"
          }
        },
        {
          "intent": "check_connectivity",
          "params": {
            "src": "PE2",
            "dst": "CE1"
          }
        }
      ],
      "reasoning_requirement": "",
      "expected_analysis_depth": "detailed",
      "evidence": {}
    }
  },
  {
    "id": "ENHANCED_ENHANCED-SCENARIO-006",
    "question": "최근 보안 점검에서 적용한 VTY ACL(set_vty_acl)이 관리 연결(특정 NMS/운영자 IP)뿐 아니라 자동화/서비스(예: BGP 피어 관리)에 미치는 영향을 식별하고, 영향받을 장비 목록과 서비스 목록을 제시하라.",
    "context": "BGP 설정 현황:\nCE1: AS65001, 1개 피어\nCE2: AS65003, 1개 피어\nsample10: AS65000, 3개 피어\nsample7: AS65000, 3개 피어\nsample8: AS65000, 3개 피어",
    "ground_truth": {
      "affected_devices": [
        "<devices_with_set_vty_acl_applied>"
      ],
      "affected_services": [
        "SSH-based management access (operator SSH to vty)",
        "Automation/orchestration using SSH (Ansible, scripts, orchestration jobs)",
        "Netconf/RESTCONF over SSH (if used on vty/SSH)",
        "Telnet-based management (if vty/telnet enabled)",
        "NMS polling or active checks that use SSH to devices",
        "BGP configuration/peer-management actions performed via SSH (management of BGP, not BGP peering itself)"
      ]
    },
    "explanation": "The ssh_acl_applied_check failing indicates a VTY ACL (set_vty_acl) has been applied to device vty lines and is blocking SSH/telnet management plane connections that are not explicitly permitted. VTY ACLs control access to the device management plane (vty lines), so any management IPs or automation hosts not included in the ACL will be denied. This directly impacts SSH-based operator/NMS connections and any automation/orchestration systems that rely on SSH (for example Ansible playbooks, scripts, or Netconf/RESTCONF sessions tunneled over SSH). Telnet would be impacted similarly if still in use. BGP peerings (TCP 179) are control-plane protocols that run between routers and are not terminated on the vty lines; therefore BGP data-plane peering itself will not be disrupted by an ACL applied only to vty lines. However, any operational tasks that manage or troubleshoot BGP via SSH (for example issuing show/configure commands, restarting BGP, or automation that modifies BGP neighbor configuration) will be prevented if the management host is blocked by the VTY ACL. To produce a definitive list of affected devices and services you must: 1) enumerate inventory to find devices where set_vty_acl was applied (search running-config for 'line vty' + 'access-class' or the configuration snippet that installs set_vty_acl); 2) for each device, retrieve the ACL contents to see which source IPs are permitted/denied (show access-lists / show ip access-lists / show running-config section vty); 3) correlate permitted IPs against known NMS/operator IP addresses and automation host IPs to identify which hosts are blocked; and 4) check device logs/AAA logs and automation job failure messages for 'connection refused/permission denied' to confirm impact. Typical diagnostic commands and checks are: show running-config | section line vty; show access-lists <name>; show ip access-lists; show logging | include ACL|Denied|SSH; review automation/NMS job failures and their source IPs; and temporarily test by permitting an NMS/automation IP in a safe manner. Remediation steps include updating the VTY ACL to explicitly allow the management/NMS/automation IPs, applying a management-plane ACL that is scoped correctly, or rolling back the set_vty_acl change after validating inventory and change windows. The placeholder '<devices_with_set_vty_acl_applied>' in the ground_truth must be replaced by the concrete device list produced by the inventory/configuration queries described above.",
    "answer_type": "long",
    "category": "advanced",
    "complexity": "scenario",
    "level": 4,
    "persona": "troubleshooter",
    "scenario": "장애 상황 대응",
    "source_files": [
      "ce1.xml",
      "ce2.xml",
      "sample10.xml",
      "sample7.xml",
      "sample8.xml",
      "sample9.xml"
    ],
    "metadata": {
      "origin": "enhanced_llm_with_agent",
      "reasoning_plan": [
        {
          "required_metric": "ssh_acl_applied_check",
          "metric_params": {
            "host": "PE1"
          }
        },
        {
          "intent": "show_users",
          "params": {
            "host": "PE1"
          }
        },
        {
          "intent": "set_vty_acl",
          "params": {
            "host": "PE1",
            "acl": "deny-unauth-admin"
          }
        },
        {
          "intent": "show_logging",
          "params": {
            "host": "PE1"
          }
        },
        {
          "intent": "show_log_include",
          "params": {
            "host": "PE1",
            "pattern": "vty|login|ssh"
          }
        }
      ],
      "reasoning_requirement": "",
      "expected_analysis_depth": "detailed",
      "evidence": {
        "step_None_ssh_acl_applied_check": false
      }
    }
  },
  {
    "id": "ENHANCED_ENHANCED-SCENARIO-007",
    "question": "OSPF area 0에 바인딩된 인터페이스 중 누락/비활성화된 인터페이스로 인해 PE가 필요한 IGP 경로를 학습하지 못해 L3VPN이 영향을 받았는지 근본 원인을 분석하라.",
    "context": "VRF 설정 현황:\nsample10: 1개 VRF (exam-l3vpn)\nsample7: 1개 VRF (exam-l3vpn)\nsample8: 1개 VRF (exam-l3vpn)\nsample9: 1개 VRF (exam-l3vpn)",
    "ground_truth": "영향을 받음",
    "explanation": "제공된 증거에 따르면 ospf_area0_if_list가 '없음'으로 보고되어 OSPF 백본(Area 0)에 바인딩된 인터페이스가 존재하지 않습니다. OSPF에서 Area 0은 백본 역할을 하므로 PE가 Area 0에 연결되어 있지 않으면 다른 영역이나 이웃으로부터 필요한 IGP 경로(백본을 통한 경로)를 학습할 수 없습니다. 결과적으로 PE가 IGP 경로를 학습하지 못하면 MP-BGP로 교환된 L3VPN 경로의 넥스트 홉을 해석하거나 라벨 기반 전달을 올바르게 구성할 수 없어 L3VPN 서비스에 영향이 발생합니다. 따라서 근본 원인은 해당 PE에서 OSPF Area 0에 바인딩된 인터페이스가 누락되었거나 비활성화되어 OSPF의 라우트 학습/교환이 이루어지지 않은 점입니다. 문제 해결을 위해서는 PE에 Area 0으로 바인딩될 적절한 인터페이스를 활성화하거나 OSPF 설정을 수정하여 백본 연결을 복구하고, OSPF 인접성 및 LSDB, IGP 경로 설치 여부(show ip ospf interface, show ip ospf neighbor, show ip route ospf 등)를 확인한 후 L3VPN(BGP VPNv4/MP-BGP) 경로 및 넥스트 홉 해석이 정상인지 재검증해야 합니다.",
    "answer_type": "short",
    "category": "advanced",
    "complexity": "scenario",
    "level": 4,
    "persona": "troubleshooter",
    "scenario": "장애 상황 대응",
    "source_files": [
      "ce1.xml",
      "ce2.xml",
      "sample10.xml",
      "sample7.xml",
      "sample8.xml",
      "sample9.xml"
    ],
    "metadata": {
      "origin": "enhanced_llm_with_agent",
      "reasoning_plan": [
        {
          "required_metric": "ospf_area0_if_list",
          "metric_params": {
            "host": "PE2"
          }
        },
        {
          "intent": "show_ip_interface_brief",
          "params": {
            "host": "PE2"
          }
        },
        {
          "intent": "show_ip_ospf_neighbor",
          "params": {
            "host": "PE2"
          }
        },
        {
          "intent": "show_ospf_database",
          "params": {
            "host": "PE2"
          }
        },
        {
          "intent": "show_ip_route_ospf",
          "params": {
            "host": "PE2"
          }
        }
      ],
      "reasoning_requirement": "",
      "expected_analysis_depth": "detailed",
      "evidence": {
        "step_None_ospf_area0_if_list": []
      }
    }
  },
  {
    "id": "ENHANCED_ENHANCED-SCENARIO-008",
    "question": "현재 네트워크의 AS 그룹(65001,65003,65000) 구성 불일치가 다른 고객/서비스에 파급되는 범위를 식별하라. 특히 어떤 PE가 잘못된 AS를 갖고 있는지, 그 PE가 호스팅하는 VRF/서비스를 모두 나열하라.",
    "context": "VRF 설정 현황:\nsample10: 1개 VRF (exam-l3vpn)\nsample7: 1개 VRF (exam-l3vpn)\nsample8: 1개 VRF (exam-l3vpn)\nsample9: 1개 VRF (exam-l3vpn)",
    "ground_truth": {
      "misconfigured_pes": [],
      "affected_vrfs": []
    },
    "explanation": "제공된 증거에서 bgp_local_as_numeric 값이 0이고 ebgp_remote_as_map과 neighbor_list_ebgp가 비어 있으며 vrf_count가 0이고 vrf_names_set이 없음으로 보고되어 있습니다. 따라서 네트워크 상에서 AS(65001, 65003, 65000) 구성 불일치를 유발하는 잘못된 AS를 가진 PE는 확인되지 않았습니다. 또한 VRF가 존재하지 않으므로 해당 문제로 인해 다른 고객이나 서비스에 파급되는 영향도 없습니다.",
    "answer_type": "short",
    "category": "advanced",
    "complexity": "scenario",
    "level": 4,
    "persona": "troubleshooter",
    "scenario": "장애 상황 대응",
    "source_files": [
      "ce1.xml",
      "ce2.xml",
      "sample10.xml",
      "sample7.xml",
      "sample8.xml",
      "sample9.xml"
    ],
    "metadata": {
      "origin": "enhanced_llm_with_agent",
      "reasoning_plan": [
        {
          "required_metric": "bgp_local_as_numeric",
          "metric_params": {
            "host": "PE1"
          }
        },
        {
          "required_metric": "ebgp_remote_as_map",
          "metric_params": {
            "host": "PE1"
          }
        },
        {
          "required_metric": "neighbor_list_ebgp",
          "metric_params": {
            "host": "PE1"
          }
        },
        {
          "required_metric": "vrf_count",
          "metric_params": {
            "host": "PE1"
          }
        },
        {
          "required_metric": "vrf_names_set",
          "metric_params": {
            "host": "PE1"
          }
        }
      ],
      "reasoning_requirement": "",
      "expected_analysis_depth": "detailed",
      "evidence": {
        "step_None_bgp_local_as_numeric": 0,
        "step_None_ebgp_remote_as_map": {},
        "step_None_neighbor_list_ebgp": [],
        "step_None_vrf_count": 0,
        "step_None_vrf_names_set": []
      }
    }
  },
  {
    "id": "ENHANCED_ENHANCED-SCENARIO-009",
    "question": "PE2에 임시 정적 라우트를 추가해 L3VPN을 복구하려고 할 때 발생할 수 있는 부작용(예: 트래픽 편향, BGP 경로 불일치)을 식별하고, 안전한 롤백 및 모니터링 절차를 상세히 제시하라.",
    "context": "BGP 설정 현황:\nCE1: AS65001, 1개 피어\nCE2: AS65003, 1개 피어\nsample10: AS65000, 3개 피어\nsample7: AS65000, 3개 피어\nsample8: AS65000, 3개 피어",
    "ground_truth": {
      "side_effects": [
        "Traffic bias/asymmetry toward PE2 causing suboptimal forwarding and potential congestion on PE2 and its links",
        "BGP route inconsistency between PEs (BGP decision mismatch) leading to split-horizon or path selection differences",
        "Blackholing if the static next-hop on PE2 is not actually reachable or the VRF forwarding table is inconsistent",
        "Route preference override (static route winning over learned BGP/VPN routes) causing removal of expected VPN paths",
        "Unintended redistribution or leakage of routes into the global RIB or into other VRFs if misconfigured",
        "Route flapping or control-plane churn if static routes are added/removed repeatedly or interact badly with route dampening",
        "Stateful features impact (e.g., RTBH, policers, BFD/ICMP reachability checks) producing false positives/negatives",
        "Monitoring/visibility gaps if telemetry/flows are not capturing the temporary path (leading to delayed detection)",
        "Persistence of stale entries in FIB/adj-RIBs after removal leading to transient forwarding anomalies"
      ],
      "safe_rollback_procedure": [
        "Pre-change: take full backup of affected PE/router configs and capture current RIB/FIB/BGP state (export show ip route, show bgp vpnv4/ipv4/ipv6, show vrf, show mpls forwarding); notify stakeholders and schedule maintenance window.",
        "Prepare and stage an automated rollback script or CLI command list that exactly reverses the static-route additions; include verification commands and timestamps in the script.",
        "Minimize scope: apply static routes only to the specific affected VRF prefixes rather than broad aggregates; use route tags and a unique tag value for temporary routes to ease identification and removal.",
        "If possible, deploy static routes with a deliberately less-preferred administrative distance than active BGP VPN routes, or use route-maps/policies to prevent accidental redistribution into BGP.",
        "Apply the static routes during the maintenance window and immediately verify RIB and FIB (show ip route vrf, show bgp vpnv4 summary) and path selection from affected CEs and PEs.",
        "If rollback is required, execute the pre-staged removal script to withdraw the static routes, then clear any soft-state (e.g., clear ip bgp <neighbor> soft out/soft in if necessary) and allow BGP to reconverge.",
        "After removal, validate route restoration by verifying that the original BGP-learned VPN routes reappear in the VRF RIB and FIB, and confirm reachability with controlled pings/traceroutes from multiple vantage points.",
        "If the static routes were redistributed or tagged, also remove any temporary redistribution rules and revoke the tags; then clear stale entries (adj-RIB, FIB) if present using targeted clears/refreshes.",
        "If rollout/rollback involved multiple PEs, perform staggered rollback with health checks between each step to avoid simultaneous flapping across the core.",
        "Document the event, timestamps, and exact commands executed, and update runbooks with lessons learned before closing the incident."
      ],
      "monitoring_and_validation_plan": [
        "Baseline collection pre-change: traffic flows (NetFlow/sFlow), per-PE CPU/memory, BGP session states, VRF route counts, interface utilization and queue drops.",
        "Immediate post-change checks: verify BGP routes (route origin and next-hop), RIB vs FIB consistency, and per-VRF forwarding entries; run scripted reachability tests between representative CEs.",
        "Continuous monitoring during change (first 30–60 minutes): alert on increases in packet drops, interface utilization > threshold (e.g., 80%), CPU > threshold (e.g., 70%), BGP peer flaps, and unexpected route count changes.",
        "Flow-level validation: compare NetFlow/sFlow before/after to detect traffic steering to PE2; set alerts for >20% deviation in expected path distribution for critical prefixes.",
        "Control-plane monitoring: track BGP update rates and route-churn metrics; trigger rollback if update rate exceeds a defined threshold or if critical BGP peers flap.",
        "Functional tests: schedule periodic synthetic transactions (pings, traceroutes, application-layer probes) from multiple vantage points and CEs to validate user experience.",
        "Health checks after rollback: confirm that routes, FIB entries, and flow patterns return to baseline within a defined convergence window (documented SLA for reconvergence).",
        "Logging and correlation: centralize syslog/telemetry and correlate alarms to detect side effects (e.g., correlated increase in drops and BGP changes), and retain logs for post-mortem.",
        "Escalation triggers and automated rollback: define explicit thresholds and automated rollback triggers (e.g., critical service outage, persistent high packet loss, BGP instability) and test the rollback automation in lab first.",
        "Post-change review: analyze monitoring data for anomalies, verify no stale routes remain, and confirm that the temporary static routes were fully removed if rollback executed."
      ]
    },
    "explanation": "Adding temporary static routes directly on PE2 to recover an L3VPN can change how traffic and routing decisions are made because static routes typically have a very low administrative distance and are installed directly into the RIB/FIB. This causes traffic to be steered toward PE2 even when BGP-learned VPN paths exist elsewhere, producing traffic bias and potential congestion on PE2 and its connected links. Because BGP election and route propagation occur independently on each PE, inserting static routes on one PE can produce BGP route inconsistencies and split-brain path selection across the network. If the configured static next-hop is not reachable from the VRF or is wrong, traffic will be blackholed. Misapplied static routes can also be inadvertently redistributed or leak into other VRFs or the global table if route policies are not explicit, and repeated add/remove cycles can create route flapping and control-plane churn.\n\nTo avoid these risks, the rollback procedure is centered on preparation, limited scope, and repeatable automation. Taking backups and capturing pre-change state allows exact restoration points. Staging a scripted rollback that precisely removes only those temporary entries and any temporary redistribution minimizes human error. Using route tags and purposely less-preferred admin distances (or restrictive route-maps) prevents the temporary configuration from unintentionally overriding normal BGP behavior or being re-advertised. Performing changes in a maintenance window with stakeholder notification reduces impact and ensures that rollback can be done methodically. After withdrawal, explicit verification (RIB/FIB checks and active reachability tests) is required to confirm the network returned to its prior stable state.\n\nMonitoring must be both immediate and continuous. Baseline metrics are necessary to detect deviations such as traffic steering to PE2, increases in packet loss, interface or CPU saturation, and BGP instability. Flow telemetry (NetFlow/sFlow) and synthetic probes help validate forwarding planes and user experience. Automated thresholds and rollback triggers ensure that human operators do not need to react under pressure and that rollbacks occur before broader damage occurs. Finally, thorough logging, correlation, and a post-mortem ensure any root cause is captured and that runbooks are improved to reduce recurrence.",
    "answer_type": "long",
    "category": "advanced",
    "complexity": "scenario",
    "level": 4,
    "persona": "troubleshooter",
    "scenario": "장애 상황 대응",
    "source_files": [],
    "metadata": {
      "origin": "enhanced_llm_with_agent",
      "reasoning_plan": [
        {
          "intent": "show_route_table",
          "params": {
            "host": "PE2",
            "vrf": "CustA-VRF"
          }
        },
        {
          "intent": "set_static_route",
          "params": {
            "host": "PE2",
            "vrf": "CustA-VRF",
            "prefix": "10.100.0.0/24",
            "next_hop": "10.0.0.254"
          }
        },
        {
          "intent": "show_bgp_summary",
          "params": {
            "host": "PE2"
          }
        },
        {
          "intent": "check_connectivity",
          "params": {
            "src": "CE1",
            "dst": "10.100.0.1"
          }
        },
        {
          "intent": "show_route_table",
          "params": {
            "host": "PE2",
            "vrf": "CustA-VRF"
          }
        }
      ],
      "reasoning_requirement": "",
      "expected_analysis_depth": "detailed",
      "evidence": {}
    }
  },
  {
    "id": "ENHANCED_ENHANCED-SCENARIO-010",
    "question": "관리보안을 위해 VTY ACL을 적용하려고 할 때 자동화와 모니터링이 영향을 받지 않도록 하기 위한 검증 항목과 적용 후 모니터링/롤백 절차를 제시하라. 필요 시 SSH proxy/jump 대안까지 포함하라.",
    "context": "보안 설정 현황:\nCE1: SSH ON, AAA OFF\nCE2: SSH ON, AAA OFF\nsample10: SSH ON, AAA ON\nsample7: SSH ON, AAA ON\nsample8: SSH ON, AAA ON",
    "ground_truth": {
      "validation_checks": [
        "Inventory target devices and record management IPs, VRFs, and OOB addresses",
        "List all automation, monitoring, NMS, backup, and operator source IPs and credentials",
        "Verify SSH service is present and functional on each device (ssh_present_bool)",
        "Gather existing VTY/line access and current ACLs applied to management plane",
        "Define least-privilege VTY ACL entries permitting only approved source IPs and required protocols/ports",
        "Include management VRF/loopback and any NAT translations in ACL design",
        "Add explicit allowances for jump/bastion hosts and emergency console/OOB addresses",
        "Prepare ACL logging rules (rate-limited) to capture denied attempts",
        "Validate ACL order, sequence numbers, and implicit deny behavior",
        "Take full configuration and ACL backups and store them off-device",
        "Stage and test ACL on lab/test device or in a maintenance window for a pilot group",
        "Prepare rollback configuration snippets and an automated rollback playbook",
        "Schedule change window and notify all stakeholders including automation owners"
      ],
      "pre_deploy_tests": [
        "From each automation/monitoring host, test SSH connectivity to target management IPs",
        "From each operator IP, test interactive login and privilege escalation",
        "Test access via planned jump/bastion hosts and verify ProxyJump/ProxyCommand behavior",
        "Run config validation tools and ACL syntax checks (lint / dry-run / candidate commit)",
        "Verify that scheduled jobs (backups, polling, scripts) can complete with the planned ACL"
      ],
      "apply_steps": [
        "Apply the VTY ACL to a single pilot device or small batch during maintenance window",
        "Enable ACL logging (rate-limited) for an observation period",
        "Validate immediate connectivity from automation, monitoring, and operator sources",
        "Monitor and review ACL logs and metrics continuously for the observation period",
        "If pilot is successful, progressively roll out to remaining devices in controlled batches"
      ],
      "post_apply_monitoring": [
        "Continuously monitor SSH session establishment and authentication success rates from automation and NMS",
        "Alert on ACL-deny log events that originate from known automation, monitoring, or operator IPs",
        "Monitor job outcomes for scheduled automation tasks, backups, and configuration pushes",
        "Track device CPU/memory and excessive auth failures to detect unintended effects",
        "Verify SNMP, syslog, traps, and telemetry delivery remain intact",
        "Maintain elevated monitoring for a defined stabilization period (e.g., 24–72 hours)"
      ],
      "rollback_procedure": [
        "If critical automation or monitoring is broken, immediately remove or replace the VTY ACL with the pre-prepared rollback snippet",
        "If remote access is lost, use OOB console or physical access to restore ACL or full config from backup",
        "If ACL removal is insufficient, restore the full saved running-config backup",
        "After rollback, open an incident, collect logs and packet captures, and run a root-cause analysis before reattempt",
        "Only reapply changes after corrective actions, updated ACL definitions, and successful re-testing"
      ],
      "ssh_proxy_jump_options": [
        "Deploy a hardened SSH bastion/jump host in the management network with strict host-based allowlists",
        "Use SSH ProxyJump (ProxyCommand) for client-to-target chaining and central logging of admin sessions",
        "Implement public key authentication and restrict keys to specific target hosts on the bastion",
        "Use multi-factor authentication and AAA integration on the jump host for stronger operator authentication",
        "Automate health checks and connectivity tests through the jump host as part of pre-deploy tests",
        "Whitelist only the bastion IP in device VTY ACLs and deny direct SSH from broad networks"
      ]
    },
    "explanation": "This answer provides a structured verification checklist and operational procedures to ensure that applying VTY ACLs does not break automation or monitoring. First, inventorying devices, management IPs, VRFs, and all automation/NMS/operator source addresses is essential so ACLs explicitly permit known good sources and avoid surprises. Verifying SSH presence (ssh_present_bool) prevents applying an ACL that blocks access when SSH is not configured or reachable. Capturing existing VTY configurations and backing up running-configs ensures a quick restore point. Designing least-privilege ACLs means permitting only required source IPs and ports (typically TCP/22) and including management VRFs and loopbacks so indirect management paths still function. Including explicit allowances for jump/bastion hosts and OOB consoles provides emergency access paths. Enabling rate-limited ACL logging for a short observation period helps detect legitimate traffic that would be blocked without producing log floods. Validating ACL order and implicit deny behavior prevents unintended denials due to sequence mistakes. Pre-deploy tests from every automation and monitoring host confirm connectivity and job completion before wide roll-out. Applying changes first to a pilot device or small batch reduces blast radius and lets you observe real behavior and logs. Post-apply monitoring should focus on SSH session rates, authentication failures, and ACL-deny events that originate from known automation or operator IPs; any such alerts should trigger immediate investigation. Also monitor scheduled job outcomes (backups, polling), SNMP/syslog/telemetry delivery, and device resource metrics to detect indirect effects. The rollback plan must be prepared and rehearsed: have ready-to-apply ACL- removal or full-config restore snippets, and specify using OOB console if remote access is lost. Document incidents and perform RCA before reapplying changes. As an alternative to permitting many source IPs directly on devices, use a hardened SSH bastion/jump host: allow only the bastion in device VTY ACLs, require keys and MFA on the bastion, and use ProxyJump/ProxyCommand so session initiation is auditable and automation can route through the bastion. Finally, automate testing and include the bastion in pre-deploy tests so you do not inadvertently lock out automation. Following these steps minimizes service disruption, provides detect-and-respond controls, and ensures a rapid rollback path if issues occur.",
    "answer_type": "long",
    "category": "advanced",
    "complexity": "scenario",
    "level": 4,
    "persona": "troubleshooter",
    "scenario": "장애 상황 대응",
    "source_files": [
      "ce1.xml",
      "ce2.xml",
      "sample10.xml",
      "sample7.xml",
      "sample8.xml",
      "sample9.xml"
    ],
    "metadata": {
      "origin": "enhanced_llm_with_agent",
      "reasoning_plan": [
        {
          "intent": "show_users",
          "params": {
            "host": "PE1"
          }
        },
        {
          "required_metric": "ssh_present_bool",
          "metric_params": {
            "host": "PE1"
          }
        },
        {
          "intent": "set_vty_acl",
          "params": {
            "host": "PE1",
            "acl": "allow-nms-and-admins"
          }
        },
        {
          "intent": "show_log_include",
          "params": {
            "host": "PE1",
            "pattern": "vty|acl|login"
          }
        },
        {
          "intent": "ssh_proxy_jump",
          "params": {
            "host": "PE1",
            "via": "P1",
            "user": "admin"
          }
        }
      ],
      "reasoning_requirement": "",
      "expected_analysis_depth": "detailed",
      "evidence": {
        "step_None_ssh_present_bool": false
      }
    }
  },
  {
    "id": "ENHANCED_ENHANCED-ANALYTICAL-001",
    "question": "For a planned new data center, what BGP topology reconfiguration (iBGP full-mesh, route reflectors, new eBGP peering or AS reassignments) will be required to keep convergence and scale acceptable long-term, and what are the concrete peer counts and missing adjacency risks to address?",
    "context": "BGP 설정 현황:\nCE1: AS65001, 1개 피어\nCE2: AS65003, 1개 피어\nsample10: AS65000, 3개 피어\nsample7: AS65000, 3개 피어\nsample8: AS65000, 3개 피어",
    "ground_truth": {
      "required_reconfiguration": [
        "Assign a proper non‑zero BGP local AS on the new DC routers.",
        "Establish at least two eBGP peerings to independent upstream ASes for external redundancy.",
        "Adopt an iBGP route‑reflector (RR) topology for scale: deploy two RRs (in separate failure domains) and make all other routers RR clients.",
        "Do not rely on an iBGP full‑mesh once the DC has more than ~4 routers; use RRs to keep peer counts and convergence manageable."
      ],
      "concrete_peer_counts": {
        "recommended_eBGP_sessions": 2,
        "recommended_route_reflectors": 2,
        "iBGP_sessions_per_leaf_router": 2,
        "iBGP_sessions_between_RRs": 1,
        "formula_total_iBGP_sessions_with_RRs": "M*2 + R*(R-1)/2  (where M = number of leaf routers, R = number of RRs; with R=2 => M*2 + 1)",
        "example_counts": {
          "small_full_mesh_example_N=5": 10,
          "RR_design_example_M=20_R=2_total_iBGP_sessions": 41
        }
      },
      "missing_adjacency_risks_to_address": [
        "No eBGP peers configured (ebgp_remote_as_map is empty) — risk of no external reachability.",
        "Local AS is unset (bgp_local_as_numeric = 0) — BGP sessions will not form until a proper AS is configured.",
        "If only one RR is deployed, that RR becomes a single point of failure for iBGP path distribution.",
        "If a full‑mesh is used beyond a small router count, exponential growth in iBGP sessions will harm CPU, memory and convergence times."
      ]
    },
    "explanation": "The provided evidence shows zero BGP neighbors, no configured eBGP remote ASes, and a local AS value of 0, which means BGP is not currently configured for the planned data center. To provide stable external reachability and avoid a single point of failure, you must first assign a valid non‑zero local AS and create eBGP sessions to at least two independent upstream ASes. For internal routing scale, a route‑reflector design is preferred once you have more than a few routers; two RRs in separate failure domains give redundancy while keeping each leaf router to only two iBGP sessions (one to each RR). RRs should peer with each other (one session for two RRs) to ensure route propagation. The concrete peer counts above follow these choices: two external eBGP sessions for redundancy, two RRs, and each leaf maintaining two iBGP sessions. The formulas and examples show how iBGP session counts scale: a full mesh requires N*(N-1)/2 sessions and becomes impractical quickly, while the RR design yields M*2 + R*(R-1)/2 total iBGP sessions (with R=2 this is M*2+1). The listed risks directly map to the empty/zero evidence fields: absence of eBGP peers and a zero local AS prevent external BGP adjacency, a single RR risks service continuity, and excessive full‑mesh iBGP creates performance and convergence problems at scale.",
    "answer_type": "long",
    "category": "advanced",
    "complexity": "analytical",
    "level": 3,
    "persona": "network_architect",
    "scenario": "네트워크 확장 계획",
    "source_files": [
      "ce1.xml",
      "ce2.xml",
      "sample10.xml",
      "sample7.xml",
      "sample8.xml",
      "sample9.xml"
    ],
    "metadata": {
      "origin": "enhanced_llm_with_agent",
      "reasoning_plan": [
        {
          "step": 1,
          "purpose": "Measure current BGP neighbor totals per device to estimate peer growth when adding DC.",
          "required_metric": "bgp_neighbor_count",
          "metric_params": {
            "host": "device1"
          }
        },
        {
          "step": 2,
          "purpose": "Confirm current iBGP completeness and quantify missing pairs that may require rework.",
          "required_metric": "ibgp_missing_pairs_count",
          "metric_params": {
            "host": "device2"
          }
        },
        {
          "step": 3,
          "purpose": "Map existing eBGP peerings and remote AS assignments to understand inter-AS topology and multihoming options.",
          "required_metric": "ebgp_remote_as_map",
          "metric_params": {
            "host": "device3"
          }
        },
        {
          "step": 4,
          "purpose": "Inspect actual neighbor/state details on candidate routers to validate adjacencies and peer health before design changes.",
          "intent": "show_bgp_neighbors",
          "params": {
            "host": "device3"
          }
        },
        {
          "step": 5,
          "purpose": "Determine local AS values to decide whether to change AS assignment strategy for the new DC (e.g., same AS vs different AS for multihoming).",
          "required_metric": "bgp_local_as_numeric",
          "metric_params": {
            "host": "device3"
          }
        }
      ],
      "reasoning_requirement": "",
      "expected_analysis_depth": "detailed",
      "evidence": {
        "step_1_bgp_neighbor_count": 0,
        "step_2_ibgp_missing_pairs_count": 0,
        "step_3_ebgp_remote_as_map": {},
        "step_5_bgp_local_as_numeric": 0
      }
    }
  },
  {
    "id": "ENHANCED_ENHANCED-ANALYTICAL-002",
    "question": "Will adding the new DC necessitate an OSPF area redesign (area splits, additional ABRs, or cost tuning) to maintain route database size and convergence SLAs, and which routers/interfaces are the primary candidates for ABR placement?",
    "context": "총 장비 수: 6 | 사용 기술: BGP, OSPF, L2VPN, L3VPN | AS 번호: 65000, 65001, 65003",
    "ground_truth": {
      "redesign_required": false,
      "abr_candidates": []
    },
    "explanation": "제공된 증거에 따르면 OSPF area 설정이 없고(ospf_area_set: 없음), area0에 속한 인터페이스 수가 0이며(ospf_area0_if_count: 0) 전체 인터페이스 수에도 문제점이 보고되지 않았습니다(interface_count: 0). 따라서 현재 상태에서는 새로운 DC 추가로 인해 즉시 OSPF 영역 재설계(영역 분할, 추가 ABR, 비용 튜닝)가 필요하다고 판단되지 않습니다. 다만 실제로 DC를 연결하면서 새로운 영역을 만들거나 대규모 접두사/경로가 유입되어 라우트 DB가 급증하거나 수렴 SLA가 악화되는 경우에는 재설계가 필요할 수 있습니다. 그런 상황이 발생하면 일반적으로 ABR은 DC의 집계/분배 계층과 백본(area 0)을 연결하는 장비, 즉 DC 업링크를 담당하는 집계 또는 코어 라우터, 그리고 WAN/경계로 동작하는 코어(엣지) 라우터들이 우선 후보가 됩니다. 권장 조치는 접두사/라우트 수와 수렴 지표를 모니터링하고, 필요 시 DC 집계·코어 경로의 라우터들을 ABR 후보로 검토하여 영역 분할 또는 비용 조정 등을 계획하는 것입니다.",
    "answer_type": "short",
    "category": "advanced",
    "complexity": "analytical",
    "level": 3,
    "persona": "network_architect",
    "scenario": "네트워크 확장 계획",
    "source_files": [
      "ce1.xml",
      "ce2.xml",
      "sample10.xml",
      "sample7.xml",
      "sample8.xml",
      "sample9.xml"
    ],
    "metadata": {
      "origin": "enhanced_llm_with_agent",
      "reasoning_plan": [
        {
          "step": 1,
          "purpose": "Identify which OSPF areas are currently used in the network.",
          "required_metric": "ospf_area_set",
          "metric_params": {
            "host": "device1"
          }
        },
        {
          "step": 2,
          "purpose": "Quantify Area 0 interface count to understand current spine/core load in backbone area.",
          "required_metric": "ospf_area0_if_count",
          "metric_params": {
            "host": "device2"
          }
        },
        {
          "step": 3,
          "purpose": "View OSPF routes on a core device to see current LSDB-derived path usage and potential hotspots.",
          "intent": "show_ip_route_ospf",
          "params": {
            "host": "device2"
          }
        },
        {
          "step": 4,
          "purpose": "Inventory interface counts to estimate growth in OSPF adjacencies and control-plane load after DC addition.",
          "required_metric": "interface_count",
          "metric_params": {
            "host": "device1"
          }
        },
        {
          "step": 5,
          "purpose": "If cost-based tuning is needed for traffic steering, plan candidate cost changes.",
          "intent": "set_ospf_cost",
          "params": {
            "host": "device2",
            "interface": "TenGigE0/1",
            "cost": 10
          }
        }
      ],
      "reasoning_requirement": "",
      "expected_analysis_depth": "detailed",
      "evidence": {
        "step_1_ospf_area_set": [],
        "step_2_ospf_area0_if_count": 0,
        "step_4_interface_count": 0
      }
    }
  },
  {
    "id": "ENHANCED_ENHANCED-ANALYTICAL-003",
    "question": "How will new DC trunk circuits and additional L2VPN endpoints affect existing L2VPN stability and what pre-emptive VC/pseudowire changes are required to avoid unidirectional or mismatch outages during expansion?",
    "context": "총 장비 수: 6 | 사용 기술: BGP, OSPF, L2VPN, L3VPN | AS 번호: 65000, 65001, 65003",
    "ground_truth": [
      "Impact: New DC trunk circuits and additional L2VPN endpoints will risk traffic re-homing, path asymmetry, and VC/pseudowire parameter mismatches that can produce unidirectional or service-mismatch outages unless proactively managed.",
      "Required pre-emptive changes:",
      "1) Pre-provision symmetric bi-directional VCs/pseudowires on all new and affected endpoints (create both directions before carrying live traffic).",
      "2) Synchronize VC/pseudowire IDs, PW parameters (encapsulation, control word usage, MTU, fragmenting behavior), and label allocations across all endpoints prior to cutover.",
      "3) Ensure consistent VLAN/tag rewrite, split-horizon and bridge-domain settings, and MAC-aging timers across sites to avoid forwarding asymmetries.",
      "4) Pre-warm and verify the control plane and forwarding state (BGP-EVPN/LDP/RSVP, LSPs, TE tunnels) so traffic uses expected symmetric paths immediately after bringing circuits up.",
      "5) Coordinate routing and TE changes to preserve symmetric return paths or explicitly steer return traffic to match forward paths.",
      "6) Stage the expansion (drain/maintenance windows, traffic mirroring), validate with end-to-end tests, and have an immediate rollback plan.",
      "7) Monitor actively for one-way packet counters, PW/VC state mismatches, MAC learning anomalies and be prepared to adjust timers or disable auto-provisioning features that could create asymmetric PWs."
    ],
    "explanation": "The provided evidence shows an existing symmetric L2VPN pairing (sample7<->sample9 and sample9<->sample7) and no current unidirectional pairs, which indicates the current deployment has bidirectional pseudowires and matching parameters. Adding new DC trunk circuits and additional L2VPN endpoints can change how traffic is routed and where pseudowires are terminated, which can introduce asymmetry or parameter mismatches that lead to one-way traffic or service-level mismatches. Unidirectional outages commonly occur when one direction of a pseudowire is not instantiated, when labels/VC IDs or encapsulation/MTU settings differ between ends, or when control-plane convergence causes one side to switch paths or LSPs while the other side does not. To prevent these failures, operators must pre-provision both directions of any new pseudowires and ensure consistency of all PW and bridge-domain parameters so there is no implicit negotiation or auto-creation that could result in asymmetric state. Synchronizing label and VC allocations prevents label/ID collisions or mismatches. Ensuring MTU, tag-rewrite, split-horizon and MAC-aging alignment avoids blackholing or asymmetric learning. Pre-warming the control plane and LSP/TE tunnels reduces transient blackholes caused by route/LSP reconvergence. Coordinating routing and TE ensures forward and return paths remain symmetric or are explicitly engineered to match, which prevents return-path asymmetry that manifests as apparent unidirectional failures. Finally, performing staged cutovers with traffic mirroring and active monitoring for one-way counters and PW state lets you validate behavior and roll back quickly if anomalies appear. These steps collectively preserve the stable, bidirectional L2VPN behavior reflected in the existing sample7<->sample9 state while enabling safe expansion.",
    "answer_type": "long",
    "category": "advanced",
    "complexity": "analytical",
    "level": 3,
    "persona": "network_architect",
    "scenario": "네트워크 확장 계획",
    "source_files": [
      "ce1.xml",
      "ce2.xml",
      "sample10.xml",
      "sample7.xml",
      "sample8.xml",
      "sample9.xml"
    ],
    "metadata": {
      "origin": "enhanced_llm_with_agent",
      "reasoning_plan": [
        {
          "step": 1,
          "purpose": "List all current L2VPN pseudowire pairs to understand topology and endpoints.",
          "required_metric": "l2vpn_pairs",
          "metric_params": {
            "host": "device4"
          }
        },
        {
          "step": 2,
          "purpose": "Identify existing unidirectional pseudowire issues that could be aggravated by added sites.",
          "required_metric": "l2vpn_unidirectional_pairs",
          "metric_params": {
            "host": "device4"
          }
        },
        {
          "step": 3,
          "purpose": "Check status/details of VCs on a core device to validate existing operational issues before adding new VCs.",
          "intent": "show_l2vpn_vc",
          "params": {
            "host": "device4"
          }
        },
        {
          "step": 4,
          "purpose": "Review VC status broadly to plan capacity and failure domains to avoid single points of failure.",
          "intent": "show_l2vpn_status",
          "params": {
            "host": "device4"
          }
        }
      ],
      "reasoning_requirement": "",
      "expected_analysis_depth": "detailed",
      "evidence": {
        "step_1_l2vpn_pairs": [
          "sample7<->sample9",
          "sample9<->sample7"
        ],
        "step_2_l2vpn_unidirectional_pairs": []
      }
    }
  },
  {
    "id": "ENHANCED_ENHANCED-ANALYTICAL-004",
    "question": "What VRF design adjustments (RD/RT normalization, VRF placement, and interface binding strategy) are needed to safely onboard the new DC while preventing route leaks and preserving VRF scale management?",
    "context": "VRF 설정 현황:\nsample10: 1개 VRF (exam-l3vpn)\nsample7: 1개 VRF (exam-l3vpn)\nsample8: 1개 VRF (exam-l3vpn)\nsample9: 1개 VRF (exam-l3vpn)",
    "ground_truth": {
      "RD_RT_normalization": [
        "Adopt a single, documented RD format that guarantees global uniqueness (for example ASN:VRF-ID or 8-byte with site-id:VRF-ID) and assign an RD per VRF instance.",
        "Assign a unique RT per VRF for export/import and keep RTs consistent across devices; use distinct RTs for shared-services versus tenant-specific VRFs.",
        "Limit RT export to only the RTs that remote sites actually need and implement explicit RT import lists so no RTs are implicitly imported.",
        "Maintain a central RT/RD registry (allocation table) and use automation/templates to enforce normalization."
      ],
      "VRF_placement": [
        "Terminate tenant VRFs at the DC edge (leaf/aggregation) and keep the core as VRF-agnostic or a minimal transport-only plane to avoid core-level VRF scale and leak surface.",
        "Use a centralized shared-services VRF for cross-tenant services that truly must be shared instead of exporting each tenant’s routes everywhere.",
        "Where multi-DC tenant presence is required, use explicit site-to-site VRF export/import policies (or controlled route leaking) rather than broad RT advertisement."
      ],
      "interface_binding_strategy": [
        "Bind access interfaces and SVIs to VRFs at the leaf/access layer so VRF membership is localized and predictable.",
        "Avoid binding a very large number of distinct VRFs to a single device; consolidate low-risk tenants into shared VRFs or use NAT/shared-services to reduce per-device VRF counts when platform limits matter.",
        "Use templates and automation for interface-to-VRF bindings, employ anycast-gateway patterns if needed, and ensure all interface bindings are accompanied by strict route-target/BGP import filters to prevent accidental leaks.",
        "Require any intentional route leaking to be done via explicit RT import/export or well-audited route-policy, never via default or permissive imports."
      ]
    },
    "explanation": "Because there are currently no existing VRFs, no per-device RT lists, and no interface bindings, you should establish a normalized RD/RT scheme up front so identifiers are unique and predictable; this prevents accidental collisions and makes automated enforcement possible. Limiting RT export and using explicit RT import lists ensure that only intended routes are shared between sites and prevent broad, uncontrolled route leaks. Placing VRF termination at the DC edge (leaf/aggregation) and keeping the core transport-focused reduces the number of devices that must host VRFs, limits the blast radius of misconfiguration, and preserves core scale. Using a centralized shared-services VRF reduces duplication of common services and avoids exporting many tenant routes just to reach shared infrastructure. For interface binding, localizing VRF bindings to leaf devices (SVIs or routed access) keeps VRF membership straightforward and reduces per-device state changes. Where device VRF scale is a concern, consolidate low-risk tenants or use shared-services/NAT to reduce the number of VRFs on constrained platforms. Finally, require all route leaking to be explicit—implemented with route-target export/import controls and BGP route policies—so that every cross-site import is intentional and auditable, thereby preserving both safety from leaks and long-term VRF scale manageability.",
    "answer_type": "long",
    "category": "advanced",
    "complexity": "analytical",
    "level": 3,
    "persona": "network_architect",
    "scenario": "네트워크 확장 계획",
    "source_files": [
      "ce1.xml",
      "ce2.xml",
      "sample10.xml",
      "sample7.xml",
      "sample8.xml",
      "sample9.xml"
    ],
    "metadata": {
      "origin": "enhanced_llm_with_agent",
      "reasoning_plan": [
        {
          "step": 1,
          "purpose": "Count VRFs to understand current scale baseline and forecast growth impact.",
          "required_metric": "vrf_count",
          "metric_params": {
            "host": "device5"
          }
        },
        {
          "step": 2,
          "purpose": "Enumerate route-target assignments per device to detect inconsistent RTs that could cause leaks.",
          "required_metric": "vrf_rt_list_per_device",
          "metric_params": {
            "host": "device5"
          }
        },
        {
          "step": 3,
          "purpose": "Inspect VRF binding to interfaces to gauge configuration complexity and needed automation for new DC interfaces.",
          "required_metric": "vrf_interface_bind_count",
          "metric_params": {
            "host": "device5"
          }
        },
        {
          "step": 4,
          "purpose": "Show VRF configuration on a candidate device to validate syntax and RT/RD usage before scaling.",
          "intent": "show_vrf",
          "params": {
            "host": "device5"
          }
        }
      ],
      "reasoning_requirement": "",
      "expected_analysis_depth": "detailed",
      "evidence": {
        "step_1_vrf_count": 0,
        "step_2_vrf_rt_list_per_device": [],
        "step_3_vrf_interface_bind_count": 0
      }
    }
  },
  {
    "id": "ENHANCED_ENHANCED-ANALYTICAL-005",
    "question": "Which BGP policy and peering changes (local-pref, AS-path prepends, additional eBGP links) should be implemented to ensure predictable failover and traffic steering for the new DC while minimizing global routing churn?",
    "context": "BGP 설정 현황:\nCE1: AS65001, 1개 피어\nCE2: AS65003, 1개 피어\nsample10: AS65000, 3개 피어\nsample7: AS65000, 3개 피어\nsample8: AS65000, 3개 피어",
    "ground_truth": [
      "Bring up at least two eBGP sessions to diverse upstream ASes/ISPs (different providers and ideally different PoPs).",
      "Designate one eBGP peer as the primary for normal inbound traffic and advertise the DC prefixes normally through that peer.",
      "Advertise the same prefixes to backup eBGP peers but prepend your AS 2–3 times on those backup peers so they are less preferred for inbound traffic.",
      "Configure internal routing so that routes learned from the primary eBGP peer receive a higher local-pref than routes learned from backups (for example local-pref 200 for primary, 100 default for others).",
      "Use BFD or equivalent fast failure detection on eBGP sessions and keep each eBGP session independent so failover is local and deterministic.",
      "Where supported, use selective BGP communities to ask upstreams to set their local-pref for your prefixes or to limit propagation instead of making global-visible attribute churn.",
      "Keep announcements to all eBGP peers rather than withdrawing prefixes on backup links; rely on AS-path prepends to prefer the primary so failover produces predictable, limited changes.",
      "Optionally advertise aggregated less-specific prefixes consistently from all peers (if addressing and upstream policy allow) to reduce global table churn on failover."
    ],
    "explanation": "The DC currently has no eBGP neighbors so the first requirement is to establish external BGP sessions; using at least two diverse upstreams avoids single‑point failures and gives alternative paths. Designating one peer as primary and advertising normally via that peer creates a predictable preferred path for inbound traffic. Advertising to backups but adding 2–3 AS‑path prepends makes the backup advertisements reachable but intentionally less attractive to the global routing system, so inbound traffic will only move to the backups when the primary becomes unavailable. Internal local-pref controls outbound selection inside your AS, so setting a higher local‑pref for routes learned from the primary ensures predictable outbound forwarding choices. Fast failure detection (BFD) and independent sessions allow quick local failover without depending on slow timers, and they avoid correlated failures. Using upstream communities where supported lets you request remote local‑pref changes or limit propagation in a way that is less disruptive than repeated withdraws or large-scale AS‑path manipulations. Keeping prefixes announced to backups (with prepends) instead of withdrawing them reduces global churn because routers see stable announcements with different path attributes rather than flaps and withdrawals. Finally, consistent use of aggregates or less‑specific advertisements (when allowed) reduces the number of prefixes that change on failover, further minimizing global routing churn.",
    "answer_type": "long",
    "category": "advanced",
    "complexity": "analytical",
    "level": 3,
    "persona": "network_architect",
    "scenario": "네트워크 확장 계획",
    "source_files": [
      "ce1.xml",
      "ce2.xml",
      "sample10.xml",
      "sample7.xml",
      "sample8.xml",
      "sample9.xml"
    ],
    "metadata": {
      "origin": "enhanced_llm_with_agent",
      "reasoning_plan": [
        {
          "step": 1,
          "purpose": "Map existing eBGP neighbors and remote AS map to identify where additional peering could be established for redundancy.",
          "required_metric": "ebgp_remote_as_map",
          "metric_params": {
            "host": "device3"
          }
        },
        {
          "step": 2,
          "purpose": "Quantify BGP neighbors to assess the scale of policy changes across devices.",
          "required_metric": "bgp_neighbor_count",
          "metric_params": {
            "host": "device3"
          }
        },
        {
          "step": 3,
          "purpose": "Inspect neighbor details to verify current attribute manipulation capabilities and session stability.",
          "intent": "show_bgp_neighbor_detail",
          "params": {
            "host": "device3",
            "neighbor": "10.0.0.1"
          }
        },
        {
          "step": 4,
          "purpose": "Propose a concrete mitigation (route-map) to influence incoming/outgoing selection during failover.",
          "intent": "set_bgp_routemap",
          "params": {
            "host": "device3",
            "routemap": "NEWDC-OUT",
            "action": "set localpref 200"
          }
        }
      ],
      "reasoning_requirement": "",
      "expected_analysis_depth": "detailed",
      "evidence": {
        "step_1_ebgp_remote_as_map": {},
        "step_2_bgp_neighbor_count": 0
      }
    }
  },
  {
    "id": "ENHANCED_ENHANCED-ANALYTICAL-006",
    "question": "What security controls (management-plane ACLs, AAA integration, SSH ACLs/jump-host patterns) must be mandated for devices in the new DC to preserve least privilege access and ensure management-plane resilience?",
    "context": "보안 설정 현황:\nCE1: SSH ON, AAA OFF\nCE2: SSH ON, AAA OFF\nsample10: SSH ON, AAA ON\nsample7: SSH ON, AAA ON\nsample8: SSH ON, AAA ON",
    "ground_truth": [
      "Deploy centralized AAA (TACACS+ or RADIUS) with role-based authorization and accounting, enforce MFA for administrative logins, and provision redundant AAA servers with failover and cached/‘break-glass’ local accounts for emergency access.",
      "Enforce management-plane ACLs (MP-ACLs) that restrict management access to a small set of trusted management subnets and bastion/jump-host IPs, applied to control-plane interfaces and device management VRFs.",
      "Mandate a hardened jump-host/bastion pattern: all SSH to devices must originate from vetted bastion hosts; bastions must use key-based auth, MFA, host-based controls, and strict ingress ACLs.",
      "Harden SSH on devices: protocol 2 only, disable password authentication where possible, require key-based auth, set idle/timeouts/session limits, enable rate-limiting and fail2ban-like lockout policies.",
      "Use an out-of-band (OOB) management network or separate management VRF/VLAN for device management and ensure MP-ACLs prevent cross-talk from production networks.",
      "Implement control-plane protection (CoPP/Control Plane Policing) and host-based rate limiting for management services to ensure management-plane resilience under attack or load.",
      "Enable full logging and accounting to a centralized SIEM/syslog (including AAA accounting), enable SNMPv3 for monitoring, and implement real-time alerting for anomalous management access.",
      "Require periodic access reviews, least-privilege RBAC policies, documented change control for MP-ACLs and jump-host rules, and automated auditing to detect deviations.",
      "Provision secure key/certificate management (PKI) for device authentication and encrypt management traffic (SSH, TLS), with automated key rotation where possible.",
      "Test and validate recovery/resilience plans: verify AAA failover, bastion availability, OOB console access, and regular destructive drills to confirm administrators can regain control if primary management paths fail."
    ],
    "explanation": "Given the evidence that six devices have SSH enabled but there is no AAA present and no SSH ACLs applied, the environment is currently exposed to unauthorized administrative access and lacks management-plane protections. Centralized AAA with RBAC and MFA is required to enforce least privilege and provide accounting; redundant AAA servers and cached local break-glass accounts are needed to maintain access if AAA is unavailable. Management-plane ACLs and a dedicated management VRF/OOB network limit the source of management connections to trusted subnets and bastion hosts, preventing direct access from arbitrary networks. A bastion/jump-host pattern centralizes and auditable access, and bastions themselves must be hardened (key-based auth, MFA, strict ingress ACLs). Devices must have hardened SSH configurations (protocol 2, key-only where possible, timeouts, rate-limiting, and lockouts) to reduce brute-force and credential theft risk. Control-plane policing protects device CPU and control-plane services from overload or DDoS, preserving management-plane resilience. Centralized logging and AAA accounting to a SIEM and periodic automated audits support detection and forensic analysis. Finally, PKI-based keys, encrypted management protocols, documented change controls, and regular failover/resilience testing ensure the management plane remains both least-privilege and resilient in operational and failure scenarios.",
    "answer_type": "long",
    "category": "advanced",
    "complexity": "analytical",
    "level": 3,
    "persona": "network_architect",
    "scenario": "네트워크 확장 계획",
    "source_files": [
      "ce1.xml",
      "ce2.xml",
      "sample10.xml",
      "sample7.xml",
      "sample8.xml",
      "sample9.xml"
    ],
    "metadata": {
      "origin": "enhanced_llm_with_agent",
      "reasoning_plan": [
        {
          "step": 1,
          "purpose": "Verify which devices have SSH enabled to ensure management access model consistency.",
          "required_metric": "ssh_enabled_devices",
          "metric_params": {
            "host": "device1"
          }
        },
        {
          "step": 2,
          "purpose": "Check whether AAA is present across devices to centralize auth/logging for the new DC.",
          "required_metric": "aaa_present_bool",
          "metric_params": {
            "host": "device1"
          }
        },
        {
          "step": 3,
          "purpose": "Confirm if SSH VTY ACLs are applied or need to be created for management plane protection.",
          "required_metric": "ssh_acl_applied_check",
          "metric_params": {
            "host": "device1"
          }
        },
        {
          "step": 4,
          "purpose": "If missing, propose a remediation to lock down VTY access.",
          "intent": "set_vty_acl",
          "params": {
            "host": "device1",
            "acl_name": "MGMT_ONLY"
          }
        }
      ],
      "reasoning_requirement": "",
      "expected_analysis_depth": "detailed",
      "evidence": {
        "step_1_ssh_enabled_devices": [
          "CE1",
          "CE2",
          "sample10",
          "sample7",
          "sample8",
          "sample9"
        ],
        "step_2_aaa_present_bool": false,
        "step_3_ssh_acl_applied_check": false
      }
    }
  },
  {
    "id": "ENHANCED_ENHANCED-ANALYTICAL-007",
    "question": "What is the recommended staged migration workflow (pre-provisioning, connectivity tests, traffic cutover, rollback) to onboard the new DC with minimal customer outage, and which concrete commands/validations should be executed during each stage?",
    "context": "총 장비 수: 6 | 사용 기술: BGP, OSPF, L2VPN, L3VPN | AS 번호: 65000, 65001, 65003",
    "ground_truth": [
      {
        "stage": "pre-provisioning",
        "objective": "Provision new DC devices, VRFs, route targets, ACLs, LB pools and application servers without impacting production.",
        "actions": [
          "Push device configs to new DC routers/switches (candidate config staging). Example commands (Cisco IOS/IOS-XE): configure terminal ; vrf definition <VRF>; ip route vrf <VRF> <prefix> <next-hop>; interface <int>; description \"NEW-DC\"",
          "On Juniper: set routing-instances <VRF> route-distinguisher <RD>; set routing-instances <VRF> protocols bgp group <grp> type external",
          "Create VRF bindings and vrf_bind_map entries as required (example config snippet): vrf_bind_map { <tenant>: { vrf: <VRF>, binds: [...] } }",
          "Create/load LB configurations in staging partition (F5 tmsh: tmsh load sys config from-terminal, or HAProxy/NGINX staging file).",
          "On compute/web servers: deploy application binaries/configs into non-production network namespace or behind disabled LB pool members.",
          "Push ACLs, route-maps and community filters but keep them in a disabled/standby state where supported."
        ],
        "validations": [
          "Configuration syntax check succeeded (vendor CLI or API returns OK).",
          "On devices: show running-config | include <VRF or binding> shows expected entries.",
          "Verify VRF bindings exist: (Cisco) show vrf ; (Juniper) show route-instance",
          "On LB stub: tmsh list ltm pool <pool> or haproxy -c -f <config> returns successful validation.",
          "Verify servers are healthy but not accepting production traffic: curl -sS --connect-timeout 2 http://<staging-server-ip>:<port>/health returns HTTP 200 locally."
        ],
        "rollback_actions": [
          "Discard staged configs or revert candidate config before commit (e.g., Cisco: configure replace or rollback; Juniper: rollback 1).",
          "Disable or delete staging LB objects."
        ]
      },
      {
        "stage": "connectivity tests (control-plane & data-plane)",
        "objective": "Verify control-plane adjacency (BGP/OSPF), route advertisement/acceptance, and basic data-plane reachability between old DC and new DC components.",
        "actions": [
          "Bring up peerings with NO export of production prefixes initially or with route-maps that block production prefixes. (Cisco example: neighbor <ip> remote-as <AS>; neighbor <ip> route-map RM-IN in).",
          "On routers/switches: show bgp summary ; show bgp neighbors <neighbor> ; show ip bgp <prefix> ; show route-map <name>",
          "Use soft-reconfiguration/clear route for soft updates: clear ip bgp <neighbor> soft in/out (if changing import).",
          "Perform VRF-specific pings and traceroutes: ping vrf <VRF> <dest> repeat 5 size 1400 ; traceroute vrf <VRF> <dest>.",
          "Run TCP/UDP sessions between test VMs in old and new DCs: iperf3 -s on server ; iperf3 -c <server> -t 30 -P 4",
          "DNS and name resolution checks: dig @<internal-dns> <service> ; nslookup <service>.",
          "Check ARP/NDP entries and MAC learning: show arp ; show mac address-table | include <MAC/IP>.",
          "Check NAT/conntrack behavior if applicable: sudo conntrack -L | grep <ip> ; sudo iptables -t nat -L -n --line-numbers."
        ],
        "validations": [
          "BGP peers show State = Established and prefix counts are as expected for non-production/test prefixes.",
          "No production prefixes are accepted/installed into RIB from new DC (route-maps must block them) unless explicitly allowed.",
          "Ping/traceroute latency and packet loss within acceptable thresholds (e.g., <5% loss, latency within SLA).",
          "iperf throughput meets minimum expected capacity for test flows.",
          "DNS resolves to test/new-IP where expected.",
          "ARP/MAC tables show correct reachability across L2/L3 fabrics."
        ],
        "rollback_actions": [
          "Shut or remove the peerings on new DC: no neighbor <ip> or deactivate BGP group; revert ACLs/route-maps to previous state."
        ]
      },
      {
        "stage": "staging & traffic mirroring (shadowing)",
        "objective": "Mirror or duplicate a copy of production traffic to the new DC without changing production forwarding; validate application behavior under real load.",
        "actions": [
          "Enable traffic mirroring on edge/ingress devices or load-balancer level (SPAN, ERSPAN, sFlow/tap, F5 packet mirroring). Example F5: tmsh modify ltm virtual <v> { mirror enabled } or use iRules to dup to new pool as passive.",
          "Alternatively, implement asymmetric routing for mirrored sessions using policy-based routing with sampled flows marked for new DC.",
          "On new DC servers: accept mirrored traffic on test interfaces or in a sandboxed path, run full application telemetry and functional tests.",
          "Run end-to-end functional tests against mirrored traffic flows (synthetic requests replayed or passive testing).",
          "Collect metrics: latency, error rates, resource utilization, application logs, DB connectivity traces."
        ],
        "validations": [
          "Mirrored traffic reaches new DC as observed via tcpdump/tshark: tcpdump -i <iface> host <source> and port <p> shows mirrored packets.",
          "Application responses from new DC are correct (compare response codes and payloads) for mirrored requests.",
          "No increase in error rate or latency seen in production path due to mirroring.",
          "Resource utilization in new DC is within expected ranges and no crashes occur."
        ],
        "rollback_actions": [
          "Disable mirroring (stop SPAN/ERSPAN or disable iRule/mirror config on LB).",
          "Remove any PBRs or sampling policies."
        ]
      },
      {
        "stage": "gradual traffic cutover (canary → partial → progressive)",
        "objective": "Shift small, controlled percentages of real traffic to the new DC progressively, verify behavior, then increase until full migration.",
        "actions": [
          "Prepare traffic-splitting mechanism: load-balancer weights, DNS low-TTL, BGP prepend/local-preference changes with limited prefix announcements, or steering via service proxy.",
          "Initial canary: send 1–5% of sessions to new DC. Example LB weight change (F5 tmsh): tmsh modify ltm pool <pool> members modify { <new-member>: { ratio 1 } <old-member>: { ratio 99 } }",
          "Validate stickiness/session persistence behavior: tmsh show ltm persistence, or check cookies/session IDs.",
          "Monitor active sessions and perform connection draining on old pool members when routing more to new DC: tmsh modify ltm pool <pool> members modify { <old-member>: { session user-disabled } } or use 'set server state maintenance' in HAProxy.",
          "For BGP-based cutover: advertise prefixes from new DC with lower MED or higher local-preference as needed, or incrementally withdraw from old DC. Use route-maps to flip next-hop only for subset of prefixes.",
          "After each step, run full transaction and user-journey tests (signup, login, payment flow, file upload/download)."
        ],
        "validations": [
          "Canary traffic success rate meets SLOs (e.g., >=99% success, error rate below threshold).",
          "End-to-end latency and backend error rates acceptable and stable over monitoring window (e.g., 15–30 minutes).",
          "No session-affinity breakage; user sessions remain intact during transitions.",
          "Application-level checks pass: database connections OK, cache hit rates normal, background jobs functioning.",
          "Network checks: show ip bgp <prefix> shows expected path selection; traceroute for live users to new DC resolves to expected path."
        ],
        "rollback_actions": [
          "Decrease weight for new DC back to 0 on LB or switch DNS/BGP back to original advertisement for affected prefixes.",
          "Drain and disable new pool members and re-enable old members if needed. Commands: tmsh modify ltm pool <pool> members modify { <new-member>: { ratio 0 } } ; tmsh modify ltm pool <pool> members modify { <old-member>: { session user-enabled } }",
          "If BGP changes applied, revert route-maps/policy and re-advertise original paths; clear BGP soft to reconverge if needed."
        ]
      },
      {
        "stage": "full cutover & validation",
        "objective": "Complete traffic migration to new DC and validate all functional, performance and operational metrics.",
        "actions": [
          "Switch all traffic distribution to new DC (LB weights, DNS, or BGP advertisements depending on method).",
          "Remove or disable old DC pool members after graceful draining: tmsh modify ltm pool <pool> members delete { <old-member> } or set state disabled and wait for connections to finish.",
          "Update monitoring/alerting to point at new DC endpoints and run full smoke tests and synthetic monitors across regions.",
          "Run a final sweep of control-plane checks: show bgp summary ; show ip route vrf <VRF> ; show route-map statistics.",
          "Validate observability: logs, metrics, tracing are flowing from new DC into central systems."
        ],
        "validations": [
          "Production traffic fully served from new DC and SLOs are met for specified windows (e.g., 1 hour, 24 hours).",
          "No unexpected increase in 5xx errors, timeouts, or dropped connections.",
          "All BGP/OSPF/IGP adjacencies stable and RIB/FIB consistent across devices.",
          "Monitoring alerts only expected ones; no new critical alerts triggered.",
          "Database replicas (if any) catch up and are in sync; data integrity checks pass for critical flows."
        ],
        "rollback_actions": [
          "If broad failure observed, trigger rollback: re-enable old DC advertisement/weights and gradually move traffic back using the gradual cutback procedure.",
          "Reinstate old configurations and monitor until stable."
        ]
      },
      {
        "stage": "post-cutover hardening & cleanup",
        "objective": "Decommission old DC routing/advertisements, finalize configs, and perform lessons-learned.",
        "actions": [
          "Remove old DC-only configs (after confirmation) such as temporary ACLs, PBRs, mirrored flows, and test-only route-maps.",
          "Update documentation, runbook and topology diagrams to reflect new production paths and VRF bindings (including vrf_bind_map updates).",
          "Perform capacity testing on new DC: full-load iperf/soak tests and spike testing.",
          "Schedule decommission tasks for old servers and network elements when safe."
        ],
        "validations": [
          "Configuration state matches intended final design; show running-config contains only desired entries.",
          "No lingering dependencies on old DC services (DNS records, automation scripts, monitoring jobs).",
          "Operational team acceptance testing completed and signed off."
        ],
        "rollback_actions": [
          "Recreate old DC artifacts if a deferred rollback becomes necessary within retention window."
        ]
      },
      {
        "stage": "rollback (emergency & staged)",
        "objective": "Provide concrete, fast rollback methods for each migration stage to restore production service to the old DC with minimal outage.",
        "emergency_actions": [
          "Traffic-level rollback via LB: set new DC pool members ratio=0 and old DC members ratio=100. Example (F5 tmsh): tmsh modify ltm pool <pool> members modify { <new-ip>: { ratio 0 } <old-ip>: { ratio 1 } }",
          "DNS rollback: change A/NS records to old DC IPs and lower TTL prior to migration to allow quick revert.",
          "BGP rollback: withdraw prefixes from new DC and re-advertise from old DC, or revert route-map/local-pref changes; use clear ip bgp * soft to expedite.",
          "Session drain reversal: re-enable old pool members and, if required, send TCP RST to new DC sessions to force re-establishment to old DC (use cautiously).",
          "If config commit caused failure, perform vendor-supported rollback: Juniper 'rollback <n>'; Cisco 'configure replace' with saved-good-config."
        ],
        "validations": [
          "After rollback, production traffic reaches old DC and SLOs restored within target RTO (documented).",
          "All BGP peers show established routes pointing to old DC and routing tables reflect pre-cutover state.",
          "Application-level functional tests succeed as they did pre-migration."
        ]
      }
    ],
    "explanation": "I produced a staged workflow that minimizes customer outage by moving from non-disruptive preparation to limited tests, passive validation (mirroring), then gradual traffic shift and final cutover. Pre-provisioning stages stage configs and VRF bindings (including vrf_bind_map) so the new DC is ready without accepting production traffic. Connectivity tests focus on control-plane (BGP/IGP) and data-plane reachability to catch routing, ARP/MAC, DNS and NAT issues early. Mirroring (shadowing) allows realistic load and application validation against production traffic without affecting customers. The gradual cutover (canary → partial → progressive) uses load-balancer weights, DNS TTLs or incremental BGP announcements so that any regression impacts only a small subset of traffic and can be rolled back quickly. Full cutover and post-cutover hardening ensure observability, capacity and cleanup are performed. For each stage I listed concrete vendor-typical commands and validations (CLI show commands, ping/traceroute/iperf, tcpdump, tmsh/haproxy checks, conntrack, BGP clears) to make tests actionable and measurable. Rollback steps are explicit and map to the corresponding changes (LB weights, DNS, BGP adverts, or config rollback) so the team can restore the previous state rapidly if SLOs are violated. This approach reduces blast radius, provides measurable gates for promotion to the next stage, and ensures reversible operations at every point.",
    "answer_type": "long",
    "category": "advanced",
    "complexity": "analytical",
    "level": 3,
    "persona": "network_architect",
    "scenario": "네트워크 확장 계획",
    "source_files": [
      "ce1.xml",
      "ce2.xml",
      "sample10.xml",
      "sample7.xml",
      "sample8.xml",
      "sample9.xml"
    ],
    "metadata": {
      "origin": "enhanced_llm_with_agent",
      "reasoning_plan": [
        {
          "step": 1,
          "purpose": "Get a high-level view of interface addressing and status for devices participating in the cutover.",
          "intent": "show_ip_interface_brief",
          "params": {
            "host": "device6"
          }
        },
        {
          "step": 2,
          "purpose": "Pre-provision or test static routes for candidate prefixes to validate reachability prior to migrating traffic.",
          "intent": "set_static_route",
          "params": {
            "host": "device6",
            "prefix": "192.0.2.0/24",
            "next_hop": "10.0.0.2"
          }
        },
        {
          "step": 3,
          "purpose": "Run an active connectivity test to verify that the new paths and VRFs carry traffic as expected.",
          "intent": "check_connectivity",
          "params": {
            "host": "device6",
            "target": "192.0.2.1"
          }
        },
        {
          "step": 4,
          "purpose": "Confirm VRF bindings to ensure customer segregation during and after migration.",
          "required_metric": "vrf_bind_map",
          "metric_params": {
            "host": "device6"
          }
        }
      ],
      "reasoning_requirement": "",
      "expected_analysis_depth": "detailed",
      "evidence": {
        "step_4_vrf_bind_map": {}
      }
    }
  },
  {
    "id": "ENHANCED_ENHANCED-ANALYTICAL-008",
    "question": "Do existing devices have sufficient control-plane capacity (CPU and per-protocol process distribution) to handle the additional BGP/OSPF adjacencies caused by the new DC, or are hardware/process reassignments required?",
    "context": "BGP 설정 현황:\nCE1: AS65001, 1개 피어\nCE2: AS65003, 1개 피어\nsample10: AS65000, 3개 피어\nsample7: AS65000, 3개 피어\nsample8: AS65000, 3개 피어",
    "ground_truth": "BGP: sufficient (no additional neighbors). OSPF: insufficient data — no OSPF processes configured, so OSPF capacity cannot be confirmed and configuration/reassessment (and possibly hardware/process reassignments) will be required before a final determination.",
    "explanation": "The provided evidence shows a BGP neighbor count of 0, indicating no additional BGP adjacencies and therefore no added BGP control-plane load is expected. The evidence also shows that no OSPF process IDs are set, which means there is no current OSPF process to evaluate and the impact of new OSPF adjacencies cannot be measured. Because OSPF is not configured, you must first configure the intended OSPF processes or otherwise identify the expected number of OSPF adjacencies and then measure per-protocol CPU utilization and process distribution. Only after those measurements (or after loading a test/expected adjacency set) can you determine if the existing control-plane CPU and process allocations are sufficient. If measurements show high CPU or process contention when OSPF is active, hardware upgrades or reassigning protocol processes (or moving responsibilities to other devices) will be required.",
    "answer_type": "long",
    "category": "advanced",
    "complexity": "analytical",
    "level": 3,
    "persona": "network_architect",
    "scenario": "네트워크 확장 계획",
    "source_files": [
      "ce1.xml",
      "ce2.xml",
      "sample10.xml",
      "sample7.xml",
      "sample8.xml",
      "sample9.xml"
    ],
    "metadata": {
      "origin": "enhanced_llm_with_agent",
      "reasoning_plan": [
        {
          "step": 1,
          "purpose": "Inspect CPU/process usage to check current headroom for additional control-plane load.",
          "intent": "show_processes_cpu",
          "params": {
            "host": "device2"
          }
        },
        {
          "step": 2,
          "purpose": "Enumerate OSPF process IDs to understand how many OSPF instances/processes are active (affects memory/CPU).",
          "required_metric": "ospf_process_ids_set",
          "metric_params": {
            "host": "device2"
          }
        },
        {
          "step": 3,
          "purpose": "Measure BGP neighbor count to estimate incremental session load on candidate routers.",
          "required_metric": "bgp_neighbor_count",
          "metric_params": {
            "host": "device2"
          }
        }
      ],
      "reasoning_requirement": "",
      "expected_analysis_depth": "detailed",
      "evidence": {
        "step_2_ospf_process_ids_set": [],
        "step_3_bgp_neighbor_count": 0
      }
    }
  },
  {
    "id": "ENHANCED_ENHANCED-ANALYTICAL-009",
    "question": "What multihoming architecture (single AS with route reflectors vs separate AS per site vs eBGP between DC and providers) provides the best balance of resilience and operational simplicity for the new DC across the existing AS groups?",
    "context": "BGP 설정 현황:\nCE1: AS65001, 1개 피어\nCE2: AS65003, 1개 피어\nsample10: AS65000, 3개 피어\nsample7: AS65000, 3개 피어\nsample8: AS65000, 3개 피어",
    "ground_truth": "Single AS with route reflectors (iBGP route-reflection across the DC and sites)",
    "explanation": "Given the evidence that there are no configured eBGP neighbors and the ebgp_remote_as_map is empty, introducing eBGP peering today would add significant operational complexity. Running a single AS internally with route reflectors provides the best balance of operational simplicity and resilience because it avoids per-site AS management and full-mesh iBGP while still allowing redundant control-plane paths through multiple, geographically redundant route reflectors. This design reduces configuration and operational overhead compared with separate AS per site and is simpler to operate than managing eBGP sessions to multiple providers, while resilience can be achieved by deploying at least two independent RRs, ensuring RRs are themselves redundant and colocated across failure domains, and keeping proper route-reflection cluster IDs and next-hop/attribute handling. If, however, external providers or business requirements force distinct AS relationships or fine-grained per-provider policy and AS-path visibility, then eBGP at the DC edge would be warranted; otherwise, the single-AS-with-RRs approach is the recommended default for balancing simplicity and resilience.",
    "answer_type": "short",
    "category": "advanced",
    "complexity": "analytical",
    "level": 3,
    "persona": "network_architect",
    "scenario": "네트워크 확장 계획",
    "source_files": [
      "ce1.xml",
      "ce2.xml",
      "sample10.xml",
      "sample7.xml",
      "sample8.xml",
      "sample9.xml"
    ],
    "metadata": {
      "origin": "enhanced_llm_with_agent",
      "reasoning_plan": [
        {
          "step": 1,
          "purpose": "List eBGP neighbor mappings to see existing multihoming patterns and potential provider adjacencies.",
          "required_metric": "ebgp_remote_as_map",
          "metric_params": {
            "host": "device3"
          }
        },
        {
          "step": 2,
          "purpose": "Get list of eBGP neighbors to plan peer additions and to ensure no unexpected remote AS conflicts.",
          "required_metric": "neighbor_list_ebgp",
          "metric_params": {
            "host": "device3"
          }
        },
        {
          "step": 3,
          "purpose": "Check BGP summary to validate session counts and identify candidate routers for extra links or route-reflection roles.",
          "intent": "show_bgp_summary",
          "params": {
            "host": "device3"
          }
        }
      ],
      "reasoning_requirement": "",
      "expected_analysis_depth": "detailed",
      "evidence": {
        "step_1_ebgp_remote_as_map": {},
        "step_2_neighbor_list_ebgp": []
      }
    }
  },
  {
    "id": "ENHANCED_ENHANCED-ANALYTICAL-010",
    "question": "What route-target/export-import policy controls and routing policy enforcement (route-maps/filters) must be put in place around the new DC to guarantee no accidental VRF route leaks, and how should these policies be applied and tested?",
    "context": "VRF 설정 현황:\nsample10: 1개 VRF (exam-l3vpn)\nsample7: 1개 VRF (exam-l3vpn)\nsample8: 1개 VRF (exam-l3vpn)\nsample9: 1개 VRF (exam-l3vpn)",
    "ground_truth": {
      "route_target_policies": [
        "Per‑VRF explicit export policy that only attaches the configured route‑target(s) to routes exported from that VRF (route‑map/route‑policy that sets the correct RT extended‑community and denies other RTs).",
        "Per‑VRF explicit import policy that only accepts routes carrying the configured route‑target(s) for that VRF and denies all other RTs (use extended‑community/RT match lists; implicit/explicit deny all otherwise).",
        "Per‑device (per‑PE) route‑target allowlists derived from the authoritative VRF→RT inventory, deployed to every PE that peers with the new DC; do not rely on broad or default accept behavior.",
        "Apply RT filtering as close to ingress as possible (on the PE facing the DC and on PE interfaces receiving VPNv4/vpnv6 routes) so unauthorized routes are dropped before propagation.",
        "Strip or normalize unexpected route‑target communities on export when necessary to prevent accidental propagation of locally attached RTs (export route‑map that removes non‑allowed RTs).",
        "If route‑reflectors are used, ensure PEs enforce RT import/export rules; do not rely on RRs to enforce VRF isolation. Apply filtering at edge PEs rather than only on RRs.",
        "Adopt a default‑deny posture for VPN route imports and only add explicit permit statements for approved RTs; maintain the approved RT list in configuration management/automation.",
        "Log and count denied import/export events and generate alerts for any refused RT imports/exports to detect misconfigurations or malicious advertisements.",
        "Ensure route distinguishers (RDs) are unique and consistent to avoid accidental VRF collisions when combined with RT enforcement."
      ],
      "application_points": [
        "Deploy export route‑maps/route‑policies on the VRF export path (on the PE when redistributing into BGP VPNv4/VPNv6 or when advertising to CE/other PEs).",
        "Deploy import route‑maps/route‑policies on inbound BGP sessions at the PE that receives routes from the new DC and on any interfaces/processes that import routes into VRFs.",
        "Apply per‑device RT allowlists on every PE that peers with the new DC; use automation to ensure consistency and to populate missing per‑device vrf_rt lists.",
        "If using route‑reflectors, keep RRs transparent for RT enforcement and ensure filtering is present at all PEs rather than relying on RRs to drop invalid RTs."
      ],
      "testing_steps": [
        "Positive test: advertise a test prefix from the new DC with the correct RT and verify it is present only in the intended VRF(s) and on expected remote PEs.",
        "Negative test: advertise prefixes from the DC with wrong or missing RTs and verify they are rejected at ingress (do not appear in any VRF, BGP VPNv4 tables, or on other PEs).",
        "Edge test: from each PE serving the DC, run routing table and BGP VPNv4/VPNv6 checks to confirm only permitted RT entries exist (show bgp vpnv4/vpnv6 sessions and routes, and show route‑target mappings).",
        "Leak simulation: attempt to intentionally leak a route (simulate misconfigured RT) and confirm that import filters on the PE prevent the leak from reaching other VRFs or remote sites.",
        "Policy verification: validate route‑maps/route‑policies are applied where intended (show run/policy, show route‑map counters) and check counters/logs for denied matches.",
        "Staged rollout: apply policies to a single PE first, run the above tests, then progressively roll out to all PEs with rollback plan and configuration snapshots available."
      ]
    },
    "explanation": "To guarantee no accidental VRF route leaks, you must adopt an explicit allowlist approach for route‑targets: only permit the exact RTs that a VRF is supposed to receive and only attach the exact RTs that a VRF is supposed to export. Import filtering should be enforced at ingress on the edge PE so that unauthorized routes never propagate into the VPNv4/VPNv6 tables or to other PEs. Because your inventory indicates there is no per‑device VRF RT list currently (vrf_rt_list_per_device: 없음), you need to create and maintain a per‑PE/per‑VRF RT allowlist and push it via automation to eliminate configuration divergence. Export policies should also ensure that only the intended RT extended communities are attached and that unexpected RTs are stripped before advertising routes outward. Relying on route‑reflectors to enforce RT isolation is risky: RRs should not be the primary enforcement point because they may reflect routes without the edge constraints, so keep enforcement on edge PEs. Adopt a default‑deny import posture and log/alert on denied imports so misconfigurations are visible quickly. Testing must include positive cases (correct RTs are accepted and reach only intended VRFs), negative cases (wrong/missing RTs are rejected and do not appear elsewhere), and deliberate leak simulations to validate filters. Verify policy application by checking route‑map/policy counters and BGP VPNv4/vpnv6 route tables on each PE, and perform a staged rollout with the ability to revert if unexpected behavior is observed. These controls together ensure that only explicitly authorized RTs and routes are exchanged, preventing accidental VRF leaks.",
    "answer_type": "long",
    "category": "advanced",
    "complexity": "analytical",
    "level": 3,
    "persona": "network_architect",
    "scenario": "네트워크 확장 계획",
    "source_files": [
      "ce1.xml",
      "ce2.xml",
      "sample10.xml",
      "sample7.xml",
      "sample8.xml",
      "sample9.xml"
    ],
    "metadata": {
      "origin": "enhanced_llm_with_agent",
      "reasoning_plan": [
        {
          "step": 1,
          "purpose": "Extract per-device RT lists to identify inconsistencies that could allow leaking.",
          "required_metric": "vrf_rt_list_per_device",
          "metric_params": {
            "host": "device5"
          }
        },
        {
          "step": 2,
          "purpose": "Show VRF configuration to validate current import/export controls and confirm candidate VRFs for stricter policies.",
          "intent": "show_vrf",
          "params": {
            "host": "device5"
          }
        },
        {
          "step": 3,
          "purpose": "Propose a concrete BGP route-policy to be applied to edge routers to prevent inadvertent import/export.",
          "intent": "set_bgp_routemap",
          "params": {
            "host": "device5",
            "routemap": "BLOCK-LEAK",
            "action": "deny matched-rt"
          }
        }
      ],
      "reasoning_requirement": "",
      "expected_analysis_depth": "detailed",
      "evidence": {
        "step_1_vrf_rt_list_per_device": []
      }
    }
  },
  {
    "id": "ENHANCED_ENHANCED-DIAGNOSTIC-001",
    "question": "모든 장비에서 AAA가 활성화되어 있고, 예외 없이 중앙 인증으로 통일되어 있는가? (미준수 장비 식별 및 우선순위 개선 권고 포함)",
    "context": "총 장비 수: 6 | 사용 기술: BGP, OSPF, L2VPN, L3VPN | AS 번호: 65000, 65001, 65003",
    "ground_truth": {
      "compliant": false,
      "non_compliant_devices": [
        "CE1"
      ],
      "remediation_priority": [
        {
          "device": "CE1",
          "priority": "High"
        }
      ]
    },
    "explanation": "제공된 증거에서 aaa_present_bool이 ❌로 표시되어 있어 AAA가 활성화되어 있지 않거나 중앙 인증으로 통일되어 있지 않음을 의미합니다. aaa_enabled_devices와 aaa_missing_devices 항목이 None으로 되어 있어 구체적 목록은 없지만 system_hostname_text가 CE1로 보고되어 있으므로 관찰된 장비 CE1이 미준수 장비로 식별됩니다. 따라서 전체 준수 여부는 '아니오'이며, 우선순위는 CE1에 대해 높음(High)으로 설정해야 합니다. 권고 조치로는 CE1에 대해 즉시 AAA를 활성화하고 중앙 인증(RADIUS/TACACS+) 서버 연동을 구성한 뒤, 구성 일관성(템플릿/정책 적용)을 확인하고 다른 장비에 대해서도 인벤토리 점검 및 감사(audit)를 수행하여 동일한 미준수 항목이 없는지 확인하는 것입니다. 변경 전 백업 및 테스트, 변경 후 인증/접속 시나리오 검증 및 모니터링 알림 설정도 병행해야 합니다.",
    "answer_type": "short",
    "category": "advanced",
    "complexity": "diagnostic",
    "level": 3,
    "persona": "compliance_officer",
    "scenario": "정책 준수 점검",
    "source_files": [
      "ce1.xml",
      "ce2.xml",
      "sample10.xml",
      "sample7.xml",
      "sample8.xml",
      "sample9.xml"
    ],
    "metadata": {
      "origin": "enhanced_llm_with_agent",
      "reasoning_plan": [
        {
          "required_metric": "aaa_enabled_devices",
          "metric_params": {
            "scope": "all_devices"
          }
        },
        {
          "required_metric": "aaa_missing_devices",
          "metric_params": {
            "scope": "all_devices"
          }
        },
        {
          "required_metric": "aaa_present_bool",
          "metric_params": {
            "scope": "all_devices"
          }
        },
        {
          "required_metric": "system_hostname_text",
          "metric_params": {
            "scope": "all_devices"
          }
        }
      ],
      "reasoning_requirement": "",
      "expected_analysis_depth": "detailed",
      "evidence": {
        "step_None_aaa_enabled_devices": null,
        "step_None_aaa_missing_devices": null,
        "step_None_aaa_present_bool": false,
        "step_None_system_hostname_text": "CE1"
      }
    }
  },
  {
    "id": "ENHANCED_ENHANCED-DIAGNOSTIC-002",
    "question": "장비들에 대해 패스워드 복잡도·길이·만료 정책이 존재하며, 모든 장비에서 일관되게 적용되고 있는가? 미준수 항목별 개선 권고를 제시하라.",
    "context": "총 장비 수: 6 | 사용 기술: BGP, OSPF, L2VPN, L3VPN | AS 번호: 65000, 65001, 65003",
    "ground_truth": "아니오 — 패스워드 복잡도·길이·만료 정책이 존재하지 않으며 모든 장비에 일관되게 적용되고 있지 않습니다.",
    "explanation": "제공된 증거에 따르면 password_policy_present_bool이 ❌로 표시되어 패스워드 정책 자체가 부재하거나 확인되지 않았습니다. 또한 aaa_enabled_devices가 None으로 되어 있어 중앙 인증·권한 부여(AAA)가 활성화되어 있지 않거나 수집되지 않았음을 의미하므로 정책을 전 장비에 일관되게 강제할 수 없는 상태입니다. system_user_count가 0으로 문제없음으로 보고되었지만 이는 로컬 시스템 사용자 수가 없는 것으로 해석될 수 있으며, 오히려 중앙정책 부재를 보완하지 못합니다. 미준수 항목별 개선 권고는 다음과 같습니다. 1) 패스워드 정책 부재: 조직의 비밀번호 보안정책을 문서화하고 최소 요구사항을 정의하십시오(권장 예: 최소 길이 12자, 대문자·소문자·숫자·특수문자 조합, 과거 5개 비밀번호 재사용 금지, 만료 주기 90일 등). 2) 정책 미적용(일관성 결여): 정책을 모든 네트워크 장비에 적용하기 위해 표준 구성 템플릿을 만들고 장비군별(라우터, 스위치, 방화벽 등)로 배포·검증하십시오. 3) AAA 미사용: RADIUS/TACACS+ 등 중앙 인증(AAA)을 도입하여 관리자 계정 및 로그인 정책을 중앙에서 강제하고 로컬 계정 의존을 최소화하십시오. 4) 로컬 계정·예외 관리: 필요 불가피한 로컬 계정은 최소화하고, 서비스 계정은 별도 관리 및 주기적 비밀번호 교체·감사를 시행하십시오. 5) 추가 보완조치: 관리자 접근에 대해 다단계 인증(MFA) 도입을 검토하고, 계정 잠금 정책(예: 실패 5회 시 15분 잠금), 인증·접속 로그 수집 및 정기 감사로 정책 준수 여부를 모니터링하십시오. 6) 실행 절차: 장비 인벤토리 작성 → 정책·템플릿 수립 → 테스트 환경에서 적용 검증 → 단계적 배포 → 배포 후 자동 검사·감사 체계 구축 순으로 시행하십시오. 이러한 조치를 통해 패스워드 관련 보안 정책을 수립하고 모든 장비에 일관되게 적용할 수 있습니다.",
    "answer_type": "short",
    "category": "advanced",
    "complexity": "diagnostic",
    "level": 3,
    "persona": "compliance_officer",
    "scenario": "정책 준수 점검",
    "source_files": [
      "ce1.xml",
      "ce2.xml",
      "sample10.xml",
      "sample7.xml",
      "sample8.xml",
      "sample9.xml"
    ],
    "metadata": {
      "origin": "enhanced_llm_with_agent",
      "reasoning_plan": [
        {
          "required_metric": "password_policy_present_bool",
          "metric_params": {
            "scope": "all_devices"
          }
        },
        {
          "required_metric": "aaa_enabled_devices",
          "metric_params": {
            "scope": "all_devices"
          }
        },
        {
          "required_metric": "system_user_count",
          "metric_params": {
            "scope": "all_devices"
          }
        }
      ],
      "reasoning_requirement": "",
      "expected_analysis_depth": "detailed",
      "evidence": {
        "step_None_password_policy_present_bool": false,
        "step_None_aaa_enabled_devices": null,
        "step_None_system_user_count": 0
      }
    }
  },
  {
    "id": "ENHANCED_ENHANCED-DIAGNOSTIC-003",
    "question": "각 장비의 로컬 사용자 계정 수가 내부 정책(예: 1~2명 비상계정 허용)을 초과하는가? 초과 장비에 대한 폐기/통제 방안을 제시하라.",
    "context": "총 장비 수: 6 | 사용 기술: BGP, OSPF, L2VPN, L3VPN | AS 번호: 65000, 65001, 65003",
    "ground_truth": false,
    "explanation": "CE1의 시스템 정보에서 system_user_count가 0으로 확인되어 내부 정책(비상계정 1~2명 허용)을 초과하지 않습니다. 다만 aaa_present_bool가 '문제'로 표시되어 중앙 인증(AAA)이 구성되어 있지 않거나 제대로 동작하지 않는 것으로 보이므로, 로컬 계정 통제 관점에서 위험요소가 존재합니다. 초과 장비에 대한 일반적인 폐기/통제 방안은 다음과 같습니다. 첫째, 초과 장비 식별 및 분류: 계정 수가 정책을 초과한 장비를 즉시 목록화하고 중요도에 따라 우선순위를 매깁니다. 둘째, 긴급제어 조치: 네트워크 분리 또는 접근제한(VLAN/ACL 적용), 임시 계정 비활성화, 관리자 계정 비밀번호 강제 변경을 시행합니다. 셋째, 계정 정리 및 표준화: 사용되지 않는 로컬 계정을 삭제하고 필요 최소한의 비상계정(1~2명)만 유지하되 계정 소유자와 사용목적을 문서화합니다. 넷째, 중앙인증 도입 및 연동: RADIUS/TACACS+ 등 AAA 서버에 연동하여 로컬 계정 의존을 최소화하고, 인증·권한관리를 중앙에서 통제합니다. 다섯째, 정책·감사·자동화: 계정 생성/변경 시 워크플로우와 승인 절차를 도입하고 정기적인 계정 감사 및 비활성 계정 자동 삭제 규칙을 적용합니다. 여섯째, 모니터링 및 로그관리: 계정 접근 및 인증 실패를 실시간으로 모니터링하고 SIEM에 연동하여 이상행위를 탐지합니다. 마지막으로, 복구 불가능하거나 보안 기준을 만족하지 못하는 장비는 재구성(이미지 재적용)하거나 교체하고, 재발 방지를 위해 구성 관리 도구(CM)로 설정 준수 여부를 자동검증하도록 합니다. CE1의 경우 현재는 계정 수 초과 문제는 없으므로 위 통제 중 중앙인증(AAA) 구성과 로그·모니터링 강화를 우선 권고합니다.",
    "answer_type": "short",
    "category": "advanced",
    "complexity": "diagnostic",
    "level": 3,
    "persona": "compliance_officer",
    "scenario": "정책 준수 점검",
    "source_files": [
      "ce1.xml",
      "ce2.xml",
      "sample10.xml",
      "sample7.xml",
      "sample8.xml",
      "sample9.xml"
    ],
    "metadata": {
      "origin": "enhanced_llm_with_agent",
      "reasoning_plan": [
        {
          "required_metric": "system_user_count",
          "metric_params": {
            "scope": "all_devices"
          }
        },
        {
          "required_metric": "aaa_present_bool",
          "metric_params": {
            "scope": "all_devices"
          }
        },
        {
          "required_metric": "system_hostname_text",
          "metric_params": {
            "scope": "all_devices"
          }
        }
      ],
      "reasoning_requirement": "",
      "expected_analysis_depth": "detailed",
      "evidence": {
        "step_None_system_user_count": 0,
        "step_None_aaa_present_bool": false,
        "step_None_system_hostname_text": "CE1"
      }
    }
  },
  {
    "id": "ENHANCED_ENHANCED-DIAGNOSTIC-004",
    "question": "모든 장비에서 SSH가 활성화되어 있고, 암호화/프로토콜 버전(권장: SSHv2) 및 관련 설정이 최신 보안 가이드를 따른다는 증거가 있는가? 미준수 장비와 구체적 수정 권고를 제시하라.",
    "context": "보안 설정 현황:\nCE1: SSH ON, AAA OFF\nCE2: SSH ON, AAA OFF\nsample10: SSH ON, AAA ON\nsample7: SSH ON, AAA ON\nsample8: SSH ON, AAA ON",
    "ground_truth": {
      "all_devices_ssh_enabled": true,
      "ssh_protocol_version": 2,
      "ssh_enabled_device_count": 6,
      "non_compliant_devices": []
    },
    "explanation": "제공된 증거에 따르면 ssh_present_bool이 정상(✅)으로 표시되었고 ssh_missing_count가 0이므로 점검 대상 장비들 전체에서 SSH가 활성화되어 있습니다. 또한 ssh_version_text가 '2'로 보고되어 있어 모든 장비가 권장 프로토콜 버전인 SSHv2를 사용하고 있는 것으로 확인됩니다. 따라서 현재 조사된 범위 내에서는 미준수 장비가 존재하지 않습니다. 그럼에도 불구하고 지속적 보안 유지와 방어 심층화를 위해 권장되는 구체적 수정·강화 조치는 다음과 같습니다. (1) SSH 프로토콜을 명시적으로 2로 고정: 네트워크 장비 예: Cisco IOS에서 'ip ssh version 2'를 설정하고 OpenSSH에서는 /etc/ssh/sshd_config에 'Protocol 2' 또는 최신 OpenSSH는 기본값으로 2만 허용하도록 구성합니다. (2) 인증 강제 및 루트 직접 로그인 제한: 패스워드 인증을 비활성화하고 공개키 인증을 사용합니다. OpenSSH 예: 'PasswordAuthentication no' 및 'PubkeyAuthentication yes', 'PermitRootLogin no'. (3) 안전한 키/암호화 알고리즘 사용: 최신 권장 알고리즘(KEX: curve25519-sha256 등, Ciphers: aes256-gcm@openssh.com, chacha20-poly1305@openssh.com 등, MACs: hmac-sha2-512/hmac-sha2-256 등)을 허용하고 약한 알고리즘(RC4, 3DES, hmac-md5 등)을 비활성화합니다. (4) 호스트 키 관리와 키 길이: 호스트 키는 ED25519 또는 최소 3072/4096 RSA를 권장하며 정기적 교체(로테이션) 및 안전한 저장 정책을 시행합니다. (5) 접속 제한 및 타임아웃 구성: 관리 접근을 허용할 IP/네트워크로 제한하는 ACL을 적용하고, 세션 타임아웃을 설정합니다(예: OpenSSH에서 'ClientAliveInterval 300' 및 'ClientAliveCountMax 2' 또는 'LoginGraceTime 60'). (6) 중앙 인증·권한 관리 및 로깅: AAA/TACACS+/RADIUS 연동, SSH 접근 로그 중앙 수집과 모니터링을 구현합니다. (7) 소프트웨어·펌웨어 업데이트 및 구성 관리: SSH 구현의 보안 패치 적용과 구성 변경에 대한 버전관리 및 감사를 실시합니다. (8) 검증 절차: 정기적으로 취약점 스캔 및 구성 감사(예: 자동화 스크립트로 프로토콜/암호화 설정 확인)를 수행합니다. 요약하면, 현재 증거로는 모든 점검 장비가 SSHv2로 활성화되어 있어 미준수 장비는 없으나 위의 구체적 권고들을 적용하여 암호화 알고리즘, 인증 방식, 접근제어, 로깅 및 패치 관리를 강화할 것을 권장합니다.",
    "answer_type": "short",
    "category": "advanced",
    "complexity": "diagnostic",
    "level": 3,
    "persona": "compliance_officer",
    "scenario": "정책 준수 점검",
    "source_files": [
      "ce1.xml",
      "ce2.xml",
      "sample10.xml",
      "sample7.xml",
      "sample8.xml",
      "sample9.xml"
    ],
    "metadata": {
      "origin": "enhanced_llm_with_agent",
      "reasoning_plan": [
        {
          "required_metric": "ssh_present_bool",
          "metric_params": {
            "scope": "all_devices"
          }
        },
        {
          "required_metric": "ssh_enabled_devices",
          "metric_params": {
            "scope": "all_devices"
          }
        },
        {
          "required_metric": "ssh_version_text",
          "metric_params": {
            "scope": "all_devices"
          }
        },
        {
          "required_metric": "ssh_missing_count",
          "metric_params": {
            "scope": "all_devices"
          }
        }
      ],
      "reasoning_requirement": "",
      "expected_analysis_depth": "detailed",
      "evidence": {
        "step_None_ssh_present_bool": true,
        "step_None_ssh_enabled_devices": [
          "CE1",
          "CE2",
          "sample10",
          "sample7",
          "sample8",
          "sample9"
        ],
        "step_None_ssh_version_text": "2",
        "step_None_ssh_missing_count": 0
      }
    }
  },
  {
    "id": "ENHANCED_ENHANCED-DIAGNOSTIC-005",
    "question": "모든 장비의 SSH/VTY 접근에 관리 ACL이 적용되어 있으며, 정책상 허용된 관리망/관리 IP만 허용하는가? 미적용 장비에 대한 표준화·시행 계획을 제시하라.",
    "context": "보안 설정 현황:\nCE1: SSH ON, AAA OFF\nCE2: SSH ON, AAA OFF\nsample10: SSH ON, AAA ON\nsample7: SSH ON, AAA ON\nsample8: SSH ON, AAA ON",
    "ground_truth": "No — management ACLs are not applied to all devices; 6 devices with SSH/VTY enabled are non‑compliant.",
    "explanation": "The automated check 'ssh_acl_applied_check' returned a failure, so the environment is not fully compliant with the policy that only management network/IPs may access device SSH/VTY. The scan shows six devices with SSH enabled (examples reported include CE1, CE2, sample10) that do not have the required management ACL applied. Recommended standardized remediation and enforcement plan: 1) Discovery & inventory: produce a definitive list of the six non‑compliant devices and any other devices with SSH/VTY enabled. 2) Risk mitigation (immediate, within 48 hours): if possible, restrict access via network ACLs or temporary firewall rules to only management IPs or place devices into a management VLAN; disable SSH temporarily only if change control permits. 3) Standard ACL template: define a canonical management ACL (for example, an IPv4/IPv6 ACL that permits management subnets and denies others, applied to VTY lines or SSH transport input), plus exact command snippets and variables (management IP ranges, logging, and rate limits). 4) Staged deployment (1–2 weeks): test the template on lab devices, then deploy to a pilot device, validate connectivity and logging, and confirm rollback procedures. 5) Automated rollout & change control: use an automation tool (Ansible/Netmiko/Config management) to push the approved ACL to all non‑compliant devices with atomic change records; require CAB approval for bulk changes. 6) Verification: after deployment, run verification scripts to confirm ACL presence and VTY behavior (e.g., commands to check vty access, ACL entries, and active sessions) and perform connectivity tests from allowed and denied IPs. 7) Monitoring & alerting: enable logging for management access attempts, configure SIEM alerts for denied/allowed anomalies, and add the ACL compliance check to the regular audit pipeline. 8) Documentation & exceptions: document the change, maintain a justified exceptions process for any device that cannot be modified, and set expiry for exceptions. 9) Enforcement & audit cadence: make the ACL check part of automated daily or weekly compliance scans and require remediation within a defined SLA (e.g., 7 calendar days for medium risk, 48 hours for high risk). 10) Closure: declare remediation complete when automated checks show all devices compliant and evidence of tested access and logging is archived. Following this plan will standardize ACLs across devices and provide ongoing enforcement and verification to meet policy requirements.",
    "answer_type": "short",
    "category": "advanced",
    "complexity": "diagnostic",
    "level": 3,
    "persona": "compliance_officer",
    "scenario": "정책 준수 점검",
    "source_files": [
      "ce1.xml",
      "ce2.xml",
      "sample10.xml",
      "sample7.xml",
      "sample8.xml",
      "sample9.xml"
    ],
    "metadata": {
      "origin": "enhanced_llm_with_agent",
      "reasoning_plan": [
        {
          "required_metric": "ssh_acl_applied_check",
          "metric_params": {
            "scope": "all_devices"
          }
        },
        {
          "required_metric": "ssh_enabled_devices",
          "metric_params": {
            "scope": "all_devices"
          }
        },
        {
          "required_metric": "system_hostname_text",
          "metric_params": {
            "scope": "all_devices"
          }
        }
      ],
      "reasoning_requirement": "",
      "expected_analysis_depth": "detailed",
      "evidence": {
        "step_None_ssh_acl_applied_check": false,
        "step_None_ssh_enabled_devices": [
          "CE1",
          "CE2",
          "sample10",
          "sample7",
          "sample8",
          "sample9"
        ],
        "step_None_system_hostname_text": "CE1"
      }
    }
  },
  {
    "id": "ENHANCED_ENHANCED-DIAGNOSTIC-006",
    "question": "각 장비의 로컬 로그 버퍼가 규정상 요구되는 최소 심각도(예: informational 또는 warnings 수준)로 설정되어 있는가? 미준수 장비에 대해 설정 변경 권고와 감사용 수집 방안을 제시하라.",
    "context": "총 장비 수: 6 | 사용 기술: BGP, OSPF, L2VPN, L3VPN | AS 번호: 65000, 65001, 65003",
    "ground_truth": {
      "CE1": {
        "compliance": "unknown",
        "recommended_setting": "로컬 로그 버퍼의 최소 심각도를 정책에 따라 informational(또는 warning) 이상으로 설정 (예: Cisco 계열의 경우 'logging buffered informational')",
        "audit_collection": [
          "현재 설정 확보: CLI로 'show running-config | include logging' 및 'show logging' 등 관련 출력 저장",
          "로그 버퍼 및 심각도 설정 스냅샷을 중앙 감사저장소(NMS 또는 파일서버)로 전송하여 보관",
          "설정 변경 시 변경 전/후 스냅샷과 변경 명령 이력(명령어 기록, 변경 요청 티켓)을 함께 보관하여 감사 증거로 제출"
        ]
      }
    },
    "explanation": "제공된 증거에는 단말 CE1의 로컬 로그 버퍼 심각도 설정값이 포함되어 있지 않으므로 해당 장비의 규정 준수 여부를 판정할 수 없습니다. 따라서 compliance 상태는 'unknown'으로 표기했습니다. 권고 설정으로는 정책에서 요구하는 최소 심각도(informational 또는 warning) 이상으로 로컬 로그 버퍼를 설정하는 것을 권장합니다. 예를 들어 Cisco 장비에서는 'logging buffered informational' 명령으로 버퍼의 최소 심각도를 설정할 수 있습니다. 감사용 수집 방안은 다음과 같습니다. 첫째, 현재 설정을 수집하기 위해 CLI에서 'show running-config | include logging' 및 'show logging' 같은 명령을 실행하여 출력 결과를 캡처합니다. 둘째, 캡처한 출력(설정 스냅샷 및 로그 관련 출력)을 중앙 감사저장소나 NMS로 전송하여 변경 전 증거로 보관합니다. 셋째, 설정 변경이 필요한 경우 변경 전 스냅샷을 보관한 뒤 변경 명령 실행, 변경 후 스냅샷을 다시 수집하여 변경 전·후 증거를 확보합니다. 마지막으로, 감사 목적의 증빙으로는 (1) 장비별 설정 스냅샷, (2) 변경 명령 및 명령 실행 시간·사용자 로그, (3) 중앙에 저장된 로그 수집 결과(가능하면 syslog 서버로의 전송 기록)를 포함해야 합니다. 또한 장비별로 공급사/모델에 따라 명령어가 다르므로 실제 적용 전 해당 장비의 관리 문서를 참조하여 정확한 명령과 저장 위치를 확인해야 합니다.",
    "answer_type": "long",
    "category": "advanced",
    "complexity": "diagnostic",
    "level": 3,
    "persona": "compliance_officer",
    "scenario": "정책 준수 점검",
    "source_files": [
      "ce1.xml",
      "ce2.xml",
      "sample10.xml",
      "sample7.xml",
      "sample8.xml",
      "sample9.xml"
    ],
    "metadata": {
      "origin": "enhanced_llm_with_agent",
      "reasoning_plan": [
        {
          "intent": "show_logging",
          "params": {
            "host": "all_devices"
          }
        },
        {
          "intent": "show_log_include",
          "params": {
            "host": "all_devices"
          }
        },
        {
          "required_metric": "system_hostname_text",
          "metric_params": {
            "scope": "all_devices"
          }
        }
      ],
      "reasoning_requirement": "",
      "expected_analysis_depth": "detailed",
      "evidence": {
        "step_None_system_hostname_text": "CE1"
      }
    }
  },
  {
    "id": "ENHANCED_ENHANCED-DIAGNOSTIC-007",
    "question": "장비들이 원격 Syslog(중앙 로그 수집)로 로그를 전송하고 있는가? 원격 로그 미구성 장비에 대해 우선 적용 방안을 제시하라.",
    "context": "총 장비 수: 6 | 사용 기술: BGP, OSPF, L2VPN, L3VPN | AS 번호: 65000, 65001, 65003",
    "ground_truth": [
      "CE1"
    ],
    "explanation": "증거의 'None단계 (system_hostname_text): CE1'은 CE1 장비가 원격 Syslog(중앙 로그 수집)로 로그를 전송하도록 구성되어 있지 않음을 의미합니다. 따라서 현재 원격 로그를 전송하지 않는 장비는 CE1입니다. 우선 적용 방안(우선순위 순)은 다음과 같습니다. 1) 인벤토리 및 확인: 네트워크 전반에서 원격 로그 미구성 장비를 추가로 식별하고 우선순위를 매깁니다(업타임, 중요 서비스 호스팅 여부 기준). 2) 중앙 수집기 정보 확정: 중앙 Syslog 서버의 IP/호스트명, 포트(예: UDP 514 또는 TCP/TLS), 프로토콜, 로그 포맷과 보존 정책을 확정합니다. 3) 네트워크 연결 검증: CE1에서 중앙 수집기까지의 경로, 방화벽/ACL 규칙을 점검하여 포트/프로토콜 접근이 가능한지 확인합니다. 4) 기본 구성 적용: CE1에 최소한의 원격 로그 설정을 적용합니다(예: logging host <syslog_IP> / logging trap <severity> 등). 5) 전송 보안 및 신뢰성 설정: 필요 시 TCP/TLS 전송, 인증서 또는 IPsec을 적용하고 로컬 버퍼링/재전송 정책을 설정합니다. 6) 검증 및 모니터링: 설정 후 CE1에서 테스트 로그를 전송하여 수집기에서 수신 확인을 수행하고, 수집 실패 시 네트워크/설정 로그를 점검합니다. 7) 운영 절차 반영: 변경관리, 롤백 계획, 모니터링 알람 및 주기적 감사 절차를 문서화하여 향후 동일 문제 재발을 방지합니다. 위 단계들을 우선순위 순으로 적용하면 CE1을 포함한 미구성 장비들을 신속하고 안전하게 중앙 로그 수집 환경에 통합할 수 있습니다.",
    "answer_type": "short",
    "category": "advanced",
    "complexity": "diagnostic",
    "level": 3,
    "persona": "compliance_officer",
    "scenario": "정책 준수 점검",
    "source_files": [
      "ce1.xml",
      "ce2.xml",
      "sample10.xml",
      "sample7.xml",
      "sample8.xml",
      "sample9.xml"
    ],
    "metadata": {
      "origin": "enhanced_llm_with_agent",
      "reasoning_plan": [
        {
          "intent": "show_logging",
          "params": {
            "host": "all_devices"
          }
        },
        {
          "required_metric": "system_hostname_text",
          "metric_params": {
            "scope": "all_devices"
          }
        }
      ],
      "reasoning_requirement": "",
      "expected_analysis_depth": "detailed",
      "evidence": {
        "step_None_system_hostname_text": "CE1"
      }
    }
  },
  {
    "id": "ENHANCED_ENHANCED-DIAGNOSTIC-008",
    "question": "SSH가 활성화된 장비의 관리 경로(직접/프록시/점프서버)와 그 접근통제(로그, ACL, 점프서버 감사)가 문서화되어 있는가? 문서화가 부족한 항목에 대해 개선 권고를 제시하라.",
    "context": "보안 설정 현황:\nCE1: SSH ON, AAA OFF\nCE2: SSH ON, AAA OFF\nsample10: SSH ON, AAA ON\nsample7: SSH ON, AAA ON\nsample8: SSH ON, AAA ON",
    "ground_truth": "문서화 여부 불명 (제공된 증거로는 관리경로 및 접근통제 문서화 여부를 판단할 수 없음)",
    "explanation": "제공된 증거는 SSH가 활성화된 장비 목록(총 6대, 예: CE1, CE2, sample10 등)과 ssh_missing_count가 0이라는 사실만을 나타냅니다. 이는 SSH 활성화 상태에 관한 정보일 뿐, 각 장비의 관리 경로(직접 접속/프록시/점프서버)나 해당 경로에 대한 접근통제(로그 설정, ACL, 점프서버 감사 여부 등)가 문서화되어 있는지에 대한 정보를 포함하고 있지 않습니다. 따라서 현재 증거만으로는 문서화 여부를 '있음' 또는 '없음'으로 판정할 수 없습니다. 개선 권고는 다음과 같습니다. (1) 자산 목록 기반 문서화: SSH 활성화 장비 목록을 바탕으로 각 장비별 관리경로(직접/프록시/점프서버)를 명확히 기재하고 중앙 CMDB 또는 운영 매뉴얼에 등록하십시오. (2) 접근통제 항목 문서화: 각 경로별로 적용된 접근통제 내용을 문서화하십시오(로그 수집 정책, ACL 규칙집, 점프서버 접속자 목록 및 권한, MFA 적용 여부 등). (3) 로그 및 감사 체계 명시: SSH 접속 로그의 저장 위치, 보존기간, 로그 포맷 및 중앙 수집(SIEM) 연동 여부와 점프서버 세션 녹화/감사 절차를 문서화하십시오. (4) 표준 템플릿 적용: 장비별 문서 템플릿(예: 관리경로, 접속 계정/역할, ACL 요약, 로그/감사 설정, 책임자)을 만들어 누락을 방지하십시오. (5) 정책 및 검증 절차: 주기적 검토 및 감사를 통해 문서와 실제 설정(ACL, 로그 활성화, 점프서버 사용 여부)이 일치하는지 확인하는 절차를 수립하십시오. (6) 보완 기술 권고: 가능한 경우 퍼블릭 접속을 차단하고 중앙 점프서버(bastion)로의 집중화를 권장하며, 점프서버에는 강제 세션 로깅, 세션 관리, MFA를 적용하십시오. (7) 우선순위 권고: 먼저 6대의 SSH 활성화 장비 각각에 대해 관리경로 및 로그/ACL/점프서버 감사 항목의 존재 여부를 확인하고 문서화 대상 목록을 작성한 뒤, 문서화가 불충분한 장비부터 순차적으로 보완하십시오. 이러한 조치를 통해 문서화의 완전성 및 접근통제의 추적 가능성을 확보할 수 있습니다.",
    "answer_type": "short",
    "category": "advanced",
    "complexity": "diagnostic",
    "level": 3,
    "persona": "compliance_officer",
    "scenario": "정책 준수 점검",
    "source_files": [
      "ce1.xml",
      "ce2.xml",
      "sample10.xml",
      "sample7.xml",
      "sample8.xml",
      "sample9.xml"
    ],
    "metadata": {
      "origin": "enhanced_llm_with_agent",
      "reasoning_plan": [
        {
          "required_metric": "ssh_enabled_devices",
          "metric_params": {
            "scope": "all_devices"
          }
        },
        {
          "required_metric": "ssh_missing_count",
          "metric_params": {
            "scope": "all_devices"
          }
        },
        {
          "intent": "ssh_proxy_jump",
          "params": {
            "host": "management_jump_host"
          }
        }
      ],
      "reasoning_requirement": "",
      "expected_analysis_depth": "detailed",
      "evidence": {
        "step_None_ssh_enabled_devices": [
          "CE1",
          "CE2",
          "sample10",
          "sample7",
          "sample8",
          "sample9"
        ],
        "step_None_ssh_missing_count": 0
      }
    }
  },
  {
    "id": "ENHANCED_ENHANCED-DIAGNOSTIC-009",
    "question": "감사 제출용으로 어떤 명령 출력(증빙)이 최소한으로 필요하며, 각 항목을 자동으로 수집할 수 있는가? (수집 명령과 장비 단위 수집 계획 포함)",
    "context": "총 장비 수: 6 | 사용 기술: BGP, OSPF, L2VPN, L3VPN | AS 번호: 65000, 65001, 65003",
    "ground_truth": [
      {
        "item": "running_config",
        "auto_collectable": true,
        "collection_commands": [
          "show running-config",
          "show running-config | include username",
          "show running-config | include enable secret",
          "show running-config | include service password-encryption",
          "show running-config | include ip ssh",
          "show running-config | include aaa",
          "show running-config | section line vty",
          "show running-config | include security passwords",
          "show running-config | include password"
        ],
        "per_device_collection_plan": "Connect to each device via SSH (or console if SSH not available). Enter enable mode if required and run the listed commands. Capture and store outputs in the central collector. Use vendor-specific filters if device output differs (e.g., 'show configuration' / 'show configuration | display set' on Junos)."
      },
      {
        "item": "startup_config",
        "auto_collectable": true,
        "collection_commands": [
          "show startup-config"
        ],
        "per_device_collection_plan": "From the same SSH session, run 'show startup-config' to capture the saved configuration for comparison with running-config. Store the output alongside the running-config output."
      },
      {
        "item": "software_and_hardware_fingerprint",
        "auto_collectable": true,
        "collection_commands": [
          "show version",
          "show inventory"
        ],
        "per_device_collection_plan": "Run 'show version' and vendor equivalent to capture OS version, image, platform, and serial numbers. This provides device identity and supports auditor verification."
      },
      {
        "item": "SSH_version_and_ssh_settings",
        "auto_collectable": true,
        "collection_commands": [
          "show ip ssh",
          "show running-config | include ip ssh",
          "show running-config | include ip domain-name",
          "show crypto key mypubkey rsa"
        ],
        "per_device_collection_plan": "Collect SSH-specific commands to prove the configured SSH version and key configuration. If device reports SSHv2 in 'show ip ssh', capture that output; otherwise capture configuration lines that show SSH settings."
      },
      {
        "item": "AAA_configuration_presence",
        "auto_collectable": true,
        "collection_commands": [
          "show running-config | section aaa",
          "show running-config | include aaa",
          "show running-config | include tacacs",
          "show running-config | include radius",
          "show tacacs",
          "show aaa servers"
        ],
        "per_device_collection_plan": "Collect AAA configuration and any configured external server definitions to prove presence or absence of AAA. If vendor uses different commands, map to vendor equivalent (e.g., 'show configuration | display set | match authentication' on Junos)."
      },
      {
        "item": "authentication_and_authorization_lines",
        "auto_collectable": true,
        "collection_commands": [
          "show running-config | section line vty",
          "show line",
          "show running-config | include login local",
          "show running-config | include authentication"
        ],
        "per_device_collection_plan": "Capture VTY/console line configuration and current line session states to demonstrate what authentication methods are applied for management access."
      },
      {
        "item": "local_user_accounts_and_secrets",
        "auto_collectable": true,
        "collection_commands": [
          "show running-config | include username",
          "show running-config | include username .* privilege",
          "show running-config | include enable secret",
          "show running-config | include enable password"
        ],
        "per_device_collection_plan": "Collect configured local users and enable secret lines from running-config. Note that secrets are typically stored encrypted and cannot be decrypted; the existence (or absence) of enable secret/username entries is the audit evidence."
      },
      {
        "item": "password_policy_settings",
        "auto_collectable": true,
        "collection_commands": [
          "show running-config | include security passwords",
          "show running-config | include password strength",
          "show running-config | include min-length",
          "show running-config | include service-password-encryption",
          "show running-config | include password-policy",
          "show configuration | display set | match password"
        ],
        "per_device_collection_plan": "Collect configuration lines that implement password policy (minimum length, complexity checks, history, aging) or demonstrate their absence. If vendor uses different syntax, use vendor-specific commands to capture equivalent settings."
      },
      {
        "item": "AAA_server_reachability_and_status",
        "auto_collectable": true,
        "collection_commands": [
          "show tacacs servers",
          "show radius servers",
          "test aaa-server authentication <name> <username> <password>",
          "ping <aaa_server_ip>",
          "show aaa authentication sessions"
        ],
        "per_device_collection_plan": "If AAA servers are configured, collect server definitions and simple reachability/status tests to demonstrate that the configured AAA infrastructure is reachable and used. Note that credentials for live tests must be handled securely and may require consent."
      },
      {
        "item": "authentication_and_audit_logs",
        "auto_collectable": true,
        "collection_commands": [
          "show logging",
          "show log",
          "show accounting",
          "show aaa accounting",
          "show logging | include %SEC_EXEC|%AUTH"
        ],
        "per_device_collection_plan": "Collect device logs and accounting outputs to show recent authentication/authorization events. Rotate and archive logs on the collector; if logs are sent to external syslog, collect the central syslog entries instead of device logs."
      }
    ],
    "explanation": "The evidence shows ssh_version_text = 2, which indicates the device reports SSH version 2 is configured, while aaa_present_bool and password_policy_present_bool are both flagged as missing. For an audit you must provide minimal, verifiable command outputs that prove (1) management access settings such as SSH and line authentication, (2) whether AAA is configured and which servers (if any) are defined, (3) local account/secret existence, and (4) explicit password policy settings or evidence of their absence. The running-config and startup-config are the canonical sources for configuration state and therefore are always required. 'show version' provides device identity and image data required by auditors. SSH settings (e.g., 'show ip ssh' or the ip ssh lines in config) are required to confirm SSHv2 is in use, which the evidence already indicates but still must be captured as output. AAA presence or absence must be proven by capturing the AAA sections or the lack thereof in the running-config and the AAA server lists; these commands are automatable via SSH/NETCONF/RESTCONF and can be filtered to reduce volume. Password policy settings are typically expressed by specific configuration lines (for example 'security passwords min-length', 'password strength-check', 'password-policy' or vendor equivalents); collecting filtered running-config output will demonstrate whether such settings exist or are missing. Authentication/authorization lines (line vty, console) and local usernames/enable secret lines prove how management logins are authenticated; note that secrets are encrypted and cannot be reversed, but their presence/absence still provides audit evidence. AAA server reachability and authentication/accounting logs are useful to demonstrate that external authentication is functional; these can be tested/collected but require careful handling of test credentials and may be environment-sensitive. All listed items are automatable in a standard collector workflow: the collector connects via SSH (or vendor API/NETCONF/RESTCONF), escalates to enable if needed, runs the vendor-appropriate commands, and stores outputs in a secure central repository. Vendor differences must be handled by mapping equivalent commands (for example IOS vs NX-OS vs Junos), and limitations such as encrypted secrets or inaccessible devices (no network access, no credentials) must be documented as exceptions. Because the provided evidence already shows SSHv2 but lacks AAA and password policy, priority should be given to collecting the AAA-related configuration and any password-policy lines to produce definitive audit evidence of their absence or presence.",
    "answer_type": "long",
    "category": "advanced",
    "complexity": "diagnostic",
    "level": 3,
    "persona": "compliance_officer",
    "scenario": "정책 준수 점검",
    "source_files": [
      "ce1.xml",
      "ce2.xml",
      "sample10.xml",
      "sample7.xml",
      "sample8.xml",
      "sample9.xml"
    ],
    "metadata": {
      "origin": "enhanced_llm_with_agent",
      "reasoning_plan": [
        {
          "intent": "show_users",
          "params": {
            "host": "all_devices"
          }
        },
        {
          "intent": "show_logging",
          "params": {
            "host": "all_devices"
          }
        },
        {
          "required_metric": "ssh_version_text",
          "metric_params": {
            "scope": "all_devices"
          }
        },
        {
          "required_metric": "aaa_present_bool",
          "metric_params": {
            "scope": "all_devices"
          }
        },
        {
          "required_metric": "password_policy_present_bool",
          "metric_params": {
            "scope": "all_devices"
          }
        }
      ],
      "reasoning_requirement": "",
      "expected_analysis_depth": "detailed",
      "evidence": {
        "step_None_ssh_version_text": "2",
        "step_None_aaa_present_bool": false,
        "step_None_password_policy_present_bool": false
      }
    }
  },
  {
    "id": "ENHANCED_ENHANCED-DIAGNOSTIC-010",
    "question": "현재 수집 가능한 지표를 바탕으로 미준수 항목(예: AAA 미구성, 패스워드 정책 부재, 로컬 로그 심각도 미달 등)의 우선순위별 개선 로드맵(단계별 작업, 권한자, 기한)을 어떻게 구성할 것인가? 감사 리포트 템플릿 예시를 포함하라.",
    "context": "총 장비 수: 6 | 사용 기술: BGP, OSPF, L2VPN, L3VPN | AS 번호: 65000, 65001, 65003",
    "ground_truth": {
      "prioritized_roadmap": [
        {
          "id": "1",
          "issue": "AAA 미구성 가능성(데이터 없음/확인 필요)",
          "severity": "Critical (확인 시)",
          "priority_rank": 1,
          "phases": [
            {
              "phase": "Immediate (1주)",
              "tasks": [
                {
                  "task": "장비 인벤토리 수집 및 AAA 구성 상태(구성 유무/서버 연동 여부) 확인",
                  "owner": "네트워크 운영팀",
                  "due": "1주 이내"
                },
                {
                  "task": "관리계정 일시적 접속 통제 및 중요 관리자 계정 암호 변경",
                  "owner": "시스템/네트워크 운영팀",
                  "due": "3일 이내"
                }
              ]
            },
            {
              "phase": "Short-term (1개월)",
              "tasks": [
                {
                  "task": "TACACS+/RADIUS 도입 여부 결정 및 서버 구축/연동 계획 수립",
                  "owner": "IAM팀 및 네트워크 보안팀",
                  "due": "2주 이내"
                },
                {
                  "task": "장비별 AAA 설정 템플릿 작성 및 파일럿 적용",
                  "owner": "네트워크 보안팀",
                  "due": "4주 이내"
                }
              ]
            },
            {
              "phase": "Medium (1-3개월)",
              "tasks": [
                {
                  "task": "전체 장비에 AAA 적용 배포 및 인증·권한 동기화 완료",
                  "owner": "네트워크 운영팀",
                  "due": "2개월"
                },
                {
                  "task": "인증/인가 로그를 중앙 로그(SIEM)으로 연동 및 모니터링 룰 작성",
                  "owner": "SOC/로그팀",
                  "due": "2개월"
                }
              ]
            },
            {
              "phase": "Long-term (3-6개월)",
              "tasks": [
                {
                  "task": "역할 기반 접근 제어(RBAC) 및 권한 분리 정책 적용",
                  "owner": "IAM팀/정보보호팀",
                  "due": "4개월"
                },
                {
                  "task": "정기 검토 및 SLA 기반 감사·보고 프로세스 수립",
                  "owner": "컴플라이언스팀",
                  "due": "6개월"
                }
              ]
            }
          ]
        },
        {
          "id": "2",
          "issue": "패스워드 정책 부재 (password_policy_present_bool: ❌)",
          "severity": "High",
          "priority_rank": 2,
          "phases": [
            {
              "phase": "Immediate (1주)",
              "tasks": [
                {
                  "task": "영향 범위 식별(AD, 로컬 계정, 네트워크 장비 등) 및 정책 부재 증거 수집",
                  "owner": "시스템/아이덴티티팀",
                  "due": "1주 이내"
                },
                {
                  "task": "임시 비밀번호 규칙(최소길이·문자조합·최소수명) 적용 및 중요 계정 재설정",
                  "owner": "시스템 운영팀",
                  "due": "3일 이내"
                }
              ]
            },
            {
              "phase": "Short-term (1개월)",
              "tasks": [
                {
                  "task": "조직 패스워드 정책 문서화 및 승인",
                  "owner": "IT 리스크/컴플라이언스",
                  "due": "2주 이내"
                },
                {
                  "task": "AD GPO, PAM 또는 기타 중앙 관리 도구를 통한 기술적 강제화 설계 및 적용",
                  "owner": "아이덴티티팀/시스템팀",
                  "due": "4주 이내"
                }
              ]
            },
            {
              "phase": "Medium (1-3개월)",
              "tasks": [
                {
                  "task": "비밀번호 저장 방식(해싱·솔트) 검토 및 필요 시 개선",
                  "owner": "시큐리티 아키텍트",
                  "due": "2개월"
                },
                {
                  "task": "공유계정 제거 및 특권계정 비밀번호 주기적 회전 프로세스 도입",
                  "owner": "운영팀/정보보호팀",
                  "due": "3개월"
                }
              ]
            },
            {
              "phase": "Long-term (3-6개월)",
              "tasks": [
                {
                  "task": "특권계정 우선으로 MFA 도입 및 사용자 인증 강화",
                  "owner": "IAM팀",
                  "due": "4-6개월"
                },
                {
                  "task": "정책 준수 모니터링과 분기별 감사 체계 수립",
                  "owner": "컴플라이언스/SOC",
                  "due": "6개월"
                }
              ]
            }
          ]
        },
        {
          "id": "3",
          "issue": "SSH 프로토콜 버전(ssh_version_text: 2)",
          "severity": "Low",
          "priority_rank": 3,
          "phases": [
            {
              "phase": "Immediate (1주)",
              "tasks": [
                {
                  "task": "SSH 프로토콜 버전이 2로 설정된 장비 목록 및 증거 기록",
                  "owner": "네트워크 운영팀",
                  "due": "3일 이내"
                }
              ]
            },
            {
              "phase": "Short-term (1개월)",
              "tasks": [
                {
                  "task": "SSH 구성 하드닝(약한 암호화/키교환/카이퍼 비활성화, PasswordAuthentication 비활성화 권고 검토)",
                  "owner": "네트워크 보안팀",
                  "due": "2주 이내"
                },
                {
                  "task": "관리 접근 제한(IP 화이트리스트, 관리 VLAN) 및 세션 타임아웃 설정",
                  "owner": "네트워크 운영팀",
                  "due": "4주 이내"
                }
              ]
            },
            {
              "phase": "Medium (1-3개월)",
              "tasks": [
                {
                  "task": "키 기반 인증 도입 및 키 관리 정책 수립",
                  "owner": "IAM/네트워크 보안팀",
                  "due": "2개월"
                },
                {
                  "task": "SSH 접속 이벤트 SIEM 연동 및 경보 규칙 추가",
                  "owner": "SOC",
                  "due": "2개월"
                }
              ]
            },
            {
              "phase": "Long-term (3-6개월)",
              "tasks": [
                {
                  "task": "정기 키 교체 정책 및 구성 검토를 통한 지속적 하드닝",
                  "owner": "정보보호팀",
                  "due": "6개월"
                }
              ]
            }
          ]
        }
      ],
      "audit_report_template": {
        "header": {
          "title": "감사 리포트",
          "organization": "[조직명]",
          "date": "YYYY-MM-DD",
          "auditor": "[감사자 이름/팀]",
          "period_of_review": "[검토 기간]"
        },
        "executive_summary": "[요약: 주요 위협, 우선순위 및 주요 권고사항 한 단락]",
        "scope_and_methodology": "[대상 시스템/장비, 수집 데이터(설정, 로그 등), 수행 방법(설정검토·로그분석·인터뷰 등)]",
        "findings": [
          {
            "id": 1,
            "title": "[간단 제목]",
            "severity": "[Critical/High/Medium/Low]",
            "description": "[문제 상세 설명]",
            "evidence": "[증거: 설정 값, 로그 스니펫, 스크린샷 등]",
            "impacted_assets": [
              "[장비/시스템 식별자]"
            ],
            "recommendation": "[구체적 권고 조치(단계 포함)]",
            "owner": "[책임부서/담당자]",
            "target_date": "YYYY-MM-DD",
            "status": "[Open/In Progress/Closed]"
          }
        ],
        "remediation_plan_summary": "[우선순위별 종합 개선 계획 표]",
        "risk_rating_methodology": "[영향도·발생확률 등 위험등급 산정 기준]",
        "kpis_and_metrics": {
          "example_metrics": [
            "미구성 장비 수",
            "정책 적용률(%)",
            "특권계정 MFA 적용 비율",
            "로그 연동 완료 장비 수"
          ]
        },
        "approval_and_signoff": {
          "it_leader": "[이름/서명]",
          "ciso": "[이름/서명]",
          "auditor": "[이름/서명]"
        },
        "appendices": "[명령어 출력, 전체 증거 목록, 로그 추출 방법 등 부속 자료]"
      }
    },
    "explanation": "제공된 증거에서 password_policy_present_bool이 ❌로 명확히 패스워드 정책 부재를 나타내므로 우선순위 상 '패스워드 정책 부재'를 빠르게 식별하고 기술적 강제화 및 조직 정책 수립을 통해 수정해야 합니다. aaa_missing_devices 항목은 현재 'None'으로 표기되어 있어 데이터가 수집되지 않았거나 상태 확인이 이루어지지 않은 것으로 판단됩니다. AAA 미구성이 실제로 존재할 경우 영향을 받는 범위가 넓고 권한·계정 통제가 불가능해지는 등 심각한 보안 위험을 초래할 수 있으므로, 우선 인벤토리와 구성 상태 확인을 즉시 수행한 뒤 미구성 장비가 확인되면 최우선으로 AAA 도입·연동을 진행하도록 우선순위를 1순위로 배치했습니다. ssh_version_text가 '2'로 나타난 것은 프로토콜 버전 측면에서 기본 요건(SSH v2)을 충족하므로 우선순위는 낮게 두되, 구성 하드닝(약한 암호화 알고리즘 비활성화, 키 기반 인증 권장, 접속 제한 등)은 권장되는 보완 조치이므로 단계적 작업으로 포함했습니다. 각 단계별 기한은 즉시 위험을 줄이기 위한 단기(3일~1주) 조치와 운영·구축이 필요한 단기~중기(2~8주), 정책 완성 및 운영 체계화가 필요한 장기(3~6개월)로 구분하여 현실적 실행 가능성을 반영했습니다. 역할(Owner)은 일반적으로 장비 구성·운영을 담당하는 네트워크 운영팀, 정책·아이덴티티 관리를 담당하는 IAM/시스템팀, 감시·알림·로그 연동을 담당하는 SOC 및 로그팀, 정책·감사·승인을 담당하는 컴플라이언스 및 정보보호팀으로 분배하는 것이 실행과 책임소재 관리를 명확히 하므로 추천합니다. 마지막으로 감사 리포트 템플릿은 실행 결과의 추적과 우선순위 확인, 책임자 지정을 위해 표준 항목(요약·범위·증거·권고·소유자·기한·상태)을 포함하도록 구성했습니다.",
    "answer_type": "long",
    "category": "advanced",
    "complexity": "diagnostic",
    "level": 3,
    "persona": "compliance_officer",
    "scenario": "정책 준수 점검",
    "source_files": [
      "ce1.xml",
      "ce2.xml",
      "sample10.xml",
      "sample7.xml",
      "sample8.xml",
      "sample9.xml"
    ],
    "metadata": {
      "origin": "enhanced_llm_with_agent",
      "reasoning_plan": [
        {
          "required_metric": "aaa_missing_devices",
          "metric_params": {
            "scope": "all_devices"
          }
        },
        {
          "required_metric": "password_policy_present_bool",
          "metric_params": {
            "scope": "all_devices"
          }
        },
        {
          "required_metric": "ssh_version_text",
          "metric_params": {
            "scope": "all_devices"
          }
        },
        {
          "intent": "show_logging",
          "params": {
            "host": "all_devices"
          }
        }
      ],
      "reasoning_requirement": "",
      "expected_analysis_depth": "detailed",
      "evidence": {
        "step_None_aaa_missing_devices": null,
        "step_None_password_policy_present_bool": false,
        "step_None_ssh_version_text": "2"
      }
    }
  },
  {
    "id": "ENHANCED_ENHANCED-ANALYTICAL-001",
    "question": "Which devices in AS 65000 have fewer than 3 iBGP peers? (Answer: device name list)",
    "context": "BGP 설정 현황:\nCE1: AS65001, 1개 피어\nCE2: AS65003, 1개 피어\nsample10: AS65000, 3개 피어\nsample7: AS65000, 3개 피어\nsample8: AS65000, 3개 피어",
    "ground_truth": [],
    "explanation": "증거에 따르면 유일한 장비는 호스트명 CE1이며 해당 장비의 bgp_local_as_numeric 값이 0으로 표시되어 있습니다. 즉 CE1은 AS 65000에 속하지 않습니다. CE1의 neighbor_list_ibgp가 '없음'으로 보고되어 iBGP 피어 수는 0이지만, 질문은 AS 65000에 속한 장비를 대상으로 하므로 CE1는 해당되지 않습니다. 증거에 AS 65000에 속한 다른 장비 정보가 전혀 없으므로 AS 65000에 속하면서 iBGP 피어가 3개 미만인 장비는 없습니다.",
    "answer_type": "short",
    "category": "advanced",
    "complexity": "analytical",
    "level": 3,
    "persona": "troubleshooter",
    "scenario": "규정 위반 장비 식별",
    "source_files": [
      "ce1.xml",
      "ce2.xml",
      "sample10.xml",
      "sample7.xml",
      "sample8.xml",
      "sample9.xml"
    ],
    "metadata": {
      "origin": "enhanced_llm_with_agent",
      "reasoning_plan": [
        {
          "required_metric": "system_hostname_text",
          "metric_params": {}
        },
        {
          "required_metric": "bgp_local_as_numeric",
          "metric_params": {
            "host": "{each_host}"
          }
        },
        {
          "required_metric": "neighbor_list_ibgp",
          "metric_params": {
            "host": "{each_host}"
          }
        },
        {
          "description": "For each host: if bgp_local_as_numeric == '65000' and length(neighbor_list_ibgp) < 3 then include hostname in result"
        }
      ],
      "reasoning_requirement": "",
      "expected_analysis_depth": "detailed",
      "evidence": {
        "step_None_system_hostname_text": "CE1",
        "step_None_bgp_local_as_numeric": 0,
        "step_None_neighbor_list_ibgp": []
      }
    }
  },
  {
    "id": "ENHANCED_ENHANCED-ANALYTICAL-002",
    "question": "How many devices have at least one missing iBGP pair? (Answer: number)",
    "context": "BGP 설정 현황:\nCE1: AS65001, 1개 피어\nCE2: AS65003, 1개 피어\nsample10: AS65000, 3개 피어\nsample7: AS65000, 3개 피어\nsample8: AS65000, 3개 피어",
    "ground_truth": 0,
    "explanation": "The provided ibgp_missing_pairs_count is 0, which indicates there are no devices that have at least one missing iBGP pair.",
    "answer_type": "short",
    "category": "advanced",
    "complexity": "analytical",
    "level": 3,
    "persona": "troubleshooter",
    "scenario": "규정 위반 장비 식별",
    "source_files": [
      "ce1.xml",
      "ce2.xml",
      "sample10.xml",
      "sample7.xml",
      "sample8.xml",
      "sample9.xml"
    ],
    "metadata": {
      "origin": "enhanced_llm_with_agent",
      "reasoning_plan": [
        {
          "required_metric": "system_hostname_text",
          "metric_params": {}
        },
        {
          "required_metric": "ibgp_missing_pairs_count",
          "metric_params": {
            "host": "{each_host}"
          }
        },
        {
          "description": "Count hosts where ibgp_missing_pairs_count > 0; return that count"
        }
      ],
      "reasoning_requirement": "",
      "expected_analysis_depth": "detailed",
      "evidence": {
        "step_None_system_hostname_text": "CE1",
        "step_None_ibgp_missing_pairs_count": 0
      }
    }
  },
  {
    "id": "ENHANCED_ENHANCED-ANALYTICAL-003",
    "question": "Which devices are involved in unidirectional L2VPN pairs? (Answer: device name list)",
    "context": "총 장비 수: 6 | 사용 기술: BGP, OSPF, L2VPN, L3VPN | AS 번호: 65000, 65001, 65003",
    "ground_truth": [],
    "explanation": "The provided evidence states that there are no entries for l2vpn_unidirectional_pairs (없음). Therefore, there are no devices involved in unidirectional L2VPN pairs, so the device list is empty.",
    "answer_type": "short",
    "category": "advanced",
    "complexity": "analytical",
    "level": 3,
    "persona": "troubleshooter",
    "scenario": "규정 위반 장비 식별",
    "source_files": [
      "ce1.xml",
      "ce2.xml",
      "sample10.xml",
      "sample7.xml",
      "sample8.xml",
      "sample9.xml"
    ],
    "metadata": {
      "origin": "enhanced_llm_with_agent",
      "reasoning_plan": [
        {
          "required_metric": "l2vpn_unidirectional_pairs",
          "metric_params": {}
        },
        {
          "description": "Extract endpoint device names from each unidirectional pair and deduplicate to produce the device name list"
        }
      ],
      "reasoning_requirement": "",
      "expected_analysis_depth": "detailed",
      "evidence": {
        "step_None_l2vpn_unidirectional_pairs": []
      }
    }
  },
  {
    "id": "ENHANCED_ENHANCED-ANALYTICAL-005",
    "question": "Which devices have SSH disabled (SSH not present)? (Answer: device name list)",
    "context": "보안 설정 현황:\nCE1: SSH ON, AAA OFF\nCE2: SSH ON, AAA OFF\nsample10: SSH ON, AAA ON\nsample7: SSH ON, AAA ON\nsample8: SSH ON, AAA ON",
    "ground_truth": [],
    "explanation": "The provided evidence indicates \"ssh_missing_devices: 없음\" (none), so no devices have SSH disabled; therefore the list of device names with SSH not present is empty.",
    "answer_type": "short",
    "category": "advanced",
    "complexity": "analytical",
    "level": 3,
    "persona": "troubleshooter",
    "scenario": "규정 위반 장비 식별",
    "source_files": [
      "ce1.xml",
      "ce2.xml",
      "sample10.xml",
      "sample7.xml",
      "sample8.xml",
      "sample9.xml"
    ],
    "metadata": {
      "origin": "enhanced_llm_with_agent",
      "reasoning_plan": [
        {
          "required_metric": "ssh_missing_devices",
          "metric_params": {}
        },
        {
          "description": "Return the ssh_missing_devices list (if empty, return empty list)"
        }
      ],
      "reasoning_requirement": "",
      "expected_analysis_depth": "detailed",
      "evidence": {
        "step_None_ssh_missing_devices": []
      }
    }
  },
  {
    "id": "ENHANCED_ENHANCED-ANALYTICAL-006",
    "question": "Which devices participate in L2VPN PWID mismatch pairs? (Answer: device name list)",
    "context": "총 장비 수: 6 | 사용 기술: BGP, OSPF, L2VPN, L3VPN | AS 번호: 65000, 65001, 65003",
    "ground_truth": [
      "sample7",
      "sample9"
    ],
    "explanation": "The evidence shows l2vpn_pwid_mismatch_pairs as sample7<->sample9 and sample9<->sample7, so the unique devices participating in these mismatch pairs are sample7 and sample9.",
    "answer_type": "short",
    "category": "advanced",
    "complexity": "analytical",
    "level": 3,
    "persona": "troubleshooter",
    "scenario": "규정 위반 장비 식별",
    "source_files": [
      "ce1.xml",
      "ce2.xml",
      "sample10.xml",
      "sample7.xml",
      "sample8.xml",
      "sample9.xml"
    ],
    "metadata": {
      "origin": "enhanced_llm_with_agent",
      "reasoning_plan": [
        {
          "required_metric": "l2vpn_pwid_mismatch_pairs",
          "metric_params": {}
        },
        {
          "description": "Extract endpoint device names from each PWID mismatch pair and deduplicate to form the device list"
        }
      ],
      "reasoning_requirement": "",
      "expected_analysis_depth": "detailed",
      "evidence": {
        "step_None_l2vpn_pwid_mismatch_pairs": [
          "sample7<->sample9",
          "sample9<->sample7"
        ]
      }
    }
  },
  {
    "id": "ENHANCED_ENHANCED-ANALYTICAL-007",
    "question": "Which devices have VRFs missing route-target (RT) assignments? (Answer: device name list)",
    "context": "VRF 설정 현황:\nsample10: 1개 VRF (exam-l3vpn)\nsample7: 1개 VRF (exam-l3vpn)\nsample8: 1개 VRF (exam-l3vpn)\nsample9: 1개 VRF (exam-l3vpn)",
    "ground_truth": [],
    "explanation": "제공된 증거에 'None단계 (vrf_without_rt_pairs): 없음'이라고 명시되어 있으므로 RT 할당이 누락된 VRF를 가진 장치가 없습니다. 따라서 장치 이름 목록은 빈 배열입니다.",
    "answer_type": "short",
    "category": "advanced",
    "complexity": "analytical",
    "level": 3,
    "persona": "troubleshooter",
    "scenario": "규정 위반 장비 식별",
    "source_files": [
      "ce1.xml",
      "ce2.xml",
      "sample10.xml",
      "sample7.xml",
      "sample8.xml",
      "sample9.xml"
    ],
    "metadata": {
      "origin": "enhanced_llm_with_agent",
      "reasoning_plan": [
        {
          "required_metric": "vrf_without_rt_pairs",
          "metric_params": {}
        },
        {
          "description": "Extract device names from vrf_without_rt_pairs and deduplicate to produce the device name list"
        }
      ],
      "reasoning_requirement": "",
      "expected_analysis_depth": "detailed",
      "evidence": {
        "step_None_vrf_without_rt_pairs": []
      }
    }
  },
  {
    "id": "ENHANCED_ENHANCED-ANALYTICAL-008",
    "question": "How many devices have more than 2 OSPF area-0 interfaces? (Answer: number)",
    "context": "총 장비 수: 6 | 사용 기술: BGP, OSPF, L2VPN, L3VPN | AS 번호: 65000, 65001, 65003",
    "ground_truth": 0,
    "explanation": "The only device listed is CE1 with ospf_area0_if_count equal to 0, which is not greater than 2; therefore zero devices have more than 2 OSPF area-0 interfaces.",
    "answer_type": "short",
    "category": "advanced",
    "complexity": "analytical",
    "level": 3,
    "persona": "troubleshooter",
    "scenario": "규정 위반 장비 식별",
    "source_files": [
      "ce1.xml",
      "ce2.xml",
      "sample10.xml",
      "sample7.xml",
      "sample8.xml",
      "sample9.xml"
    ],
    "metadata": {
      "origin": "enhanced_llm_with_agent",
      "reasoning_plan": [
        {
          "required_metric": "system_hostname_text",
          "metric_params": {}
        },
        {
          "required_metric": "ospf_area0_if_count",
          "metric_params": {
            "host": "{each_host}"
          }
        },
        {
          "description": "Count hosts where ospf_area0_if_count > 2 and return that count"
        }
      ],
      "reasoning_requirement": "",
      "expected_analysis_depth": "detailed",
      "evidence": {
        "step_None_system_hostname_text": "CE1",
        "step_None_ospf_area0_if_count": 0
      }
    }
  },
  {
    "id": "ENHANCED_ENHANCED-ANALYTICAL-009",
    "question": "Which devices have more than 48 interfaces? (Answer: device name list)",
    "context": "총 장비 수: 6 | 사용 기술: BGP, OSPF, L2VPN, L3VPN | AS 번호: 65000, 65001, 65003",
    "ground_truth": [],
    "explanation": "No devices have more than 48 interfaces. The only device provided in the evidence is CE1 with an interface count of 0, which is not greater than 48.",
    "answer_type": "short",
    "category": "advanced",
    "complexity": "analytical",
    "level": 3,
    "persona": "troubleshooter",
    "scenario": "규정 위반 장비 식별",
    "source_files": [
      "ce1.xml",
      "ce2.xml",
      "sample10.xml",
      "sample7.xml",
      "sample8.xml",
      "sample9.xml"
    ],
    "metadata": {
      "origin": "enhanced_llm_with_agent",
      "reasoning_plan": [
        {
          "required_metric": "system_hostname_text",
          "metric_params": {}
        },
        {
          "required_metric": "interface_count",
          "metric_params": {
            "host": "{each_host}"
          }
        },
        {
          "description": "Return list of hosts where interface_count > 48"
        }
      ],
      "reasoning_requirement": "",
      "expected_analysis_depth": "detailed",
      "evidence": {
        "step_None_system_hostname_text": "CE1",
        "step_None_interface_count": 0
      }
    }
  },
  {
    "id": "ENHANCED_ENHANCED-ANALYTICAL-010",
    "question": "What is the hostname of the device with the highest local user count? (Answer: hostname string)",
    "context": "총 장비 수: 6 | 사용 기술: BGP, OSPF, L2VPN, L3VPN | AS 번호: 65000, 65001, 65003",
    "ground_truth": "CE1",
    "explanation": "The provided evidence lists a single device with hostname CE1 and a local user count of 0; because it is the only device reported, CE1 has the highest local user count among the devices in the evidence.",
    "answer_type": "short",
    "category": "advanced",
    "complexity": "analytical",
    "level": 3,
    "persona": "troubleshooter",
    "scenario": "규정 위반 장비 식별",
    "source_files": [
      "ce1.xml",
      "ce2.xml",
      "sample10.xml",
      "sample7.xml",
      "sample8.xml",
      "sample9.xml"
    ],
    "metadata": {
      "origin": "enhanced_llm_with_agent",
      "reasoning_plan": [
        {
          "required_metric": "system_hostname_text",
          "metric_params": {}
        },
        {
          "required_metric": "system_user_count",
          "metric_params": {
            "host": "{each_host}"
          }
        },
        {
          "description": "Find the host with the maximum system_user_count; return that hostname (if tie, return all tied hostnames as a single comma-separated string)"
        }
      ],
      "reasoning_requirement": "",
      "expected_analysis_depth": "detailed",
      "evidence": {
        "step_None_system_hostname_text": "CE1",
        "step_None_system_user_count": 0
      }
    }
  },
  {
    "id": "ENHANCED_ENHANCED-DIAGNOSTIC-001",
    "question": "rtr-core1에서 iBGP 세션이 수립되지 않습니다(원인 가정: AS 번호 불일치 AS mismatch). 문제를 진단하기 위해 rtr-core1에서 순서대로 실행할 CLI 명령어 3가지를 적어주세요.",
    "context": "BGP 설정 현황:\nCE1: AS65001, 1개 피어\nCE2: AS65003, 1개 피어\nsample10: AS65000, 3개 피어\nsample7: AS65000, 3개 피어\nsample8: AS65000, 3개 피어",
    "ground_truth": [
      "show ip bgp summary",
      "show ip bgp neighbors <peer-ip> detail",
      "show running-config | section router bgp"
    ],
    "explanation": "첫 번째 명령어는 전체 BGP 이웃들의 상태를 빠르게 확인하여 어떤 피어가 Down인지, 피어의 IP와 상태(Idle/Active/Active(Negotiation)/Established 등)를 확인하기 위해 사용합니다. 두 번째 명령어는 특정 피어(<peer-ip>)의 상세 정보를 보여주며 Remote AS 값, 최근 에러 메시지(예: ‘bad peer AS’나 ‘wrong AS’ 관련 로그) 및 세션 협상 과정의 상세 원인을 확인하는 데 필요합니다. 세 번째 명령어는 라우터의 BGP 설정(로컬 AS 번호와 neighbor 설정 포함)을 직접 확인하여 로컬에 설정된 AS 번호와 이웃에 설정된 remote-as 값이 일치하는지, 설정상 오타나 잘못된 IP가 없는지 검증하기 위해 사용합니다. 이 순서대로 진단하면 먼저 문제가 발생한 피어를 식별하고 해당 피어의 실제 remote AS 값을 확인한 다음 로컬 설정과 대조하여 AS 불일치 여부를 확정할 수 있습니다.",
    "answer_type": "short",
    "category": "advanced",
    "complexity": "diagnostic",
    "level": 3,
    "persona": "troubleshooter",
    "scenario": "장애 진단 명령어 시퀀스",
    "source_files": [],
    "metadata": {
      "origin": "enhanced_llm_with_agent",
      "reasoning_plan": [
        {
          "intent": "show_bgp_summary",
          "params": {
            "host": "rtr-core1"
          }
        },
        {
          "intent": "show_bgp_neighbors",
          "params": {
            "host": "rtr-core1"
          }
        },
        {
          "intent": "show_bgp_neighbor_detail",
          "params": {
            "host": "rtr-core1",
            "neighbor_ip": "10.0.12.2"
          }
        }
      ],
      "reasoning_requirement": "",
      "expected_analysis_depth": "detailed",
      "evidence": {}
    }
  },
  {
    "id": "ENHANCED_ENHANCED-DIAGNOSTIC-002",
    "question": "rtr-edge1에서 rtr-pe1로의 eBGP 세션이 DOWN입니다(원인 가정: 원격 AS 설정 오류). rtr-edge1에서 진단을 위해 순서대로 실행할 CLI 명령 3가지를 적어주세요.",
    "context": "BGP 설정 현황:\nCE1: AS65001, 1개 피어\nCE2: AS65003, 1개 피어\nsample10: AS65000, 3개 피어\nsample7: AS65000, 3개 피어\nsample8: AS65000, 3개 피어",
    "ground_truth": [
      "show ip bgp summary",
      "show ip bgp neighbors <PEER_IP> detail",
      "show running-config | section router bgp"
    ],
    "explanation": "첫 번째 명령은 전체 BGP 피어들의 상태를 빠르게 확인하여 rtr-pe1과의 세션이 실제로 DOWN인지와 상태(Idle/Active/Connect 등)를 확인하기 위함입니다. 두 번째 명령은 특정 피어(<PEER_IP>)에 대한 상세 정보를 보여주어 현재 보고되는 Remote AS 값, 로컬 AS와의 불일치 여부, 최근 에러 메시지(TCP 재시도, 버전/AS 불일치 등)를 확인하는 데 필요합니다. 세 번째 명령은 라우터의 실제 BGP 설정을 확인하여 neighbor 구문에 설정된 remote-as 값이 무엇인지 검증하고, 상세 출력에서 보인 Remote AS와 비교하여 설정 오류(원격 AS 입력 실수 등)를 찾아내기 위함입니다.",
    "answer_type": "short",
    "category": "advanced",
    "complexity": "diagnostic",
    "level": 3,
    "persona": "troubleshooter",
    "scenario": "장애 진단 명령어 시퀀스",
    "source_files": [],
    "metadata": {
      "origin": "enhanced_llm_with_agent",
      "reasoning_plan": [
        {
          "intent": "show_bgp_summary",
          "params": {
            "host": "rtr-edge1"
          }
        },
        {
          "intent": "show_bgp_neighbors",
          "params": {
            "host": "rtr-edge1"
          }
        },
        {
          "intent": "show_bgp_neighbor_detail",
          "params": {
            "host": "rtr-edge1",
            "neighbor_ip": "203.0.113.1"
          }
        }
      ],
      "reasoning_requirement": "",
      "expected_analysis_depth": "detailed",
      "evidence": {}
    }
  },
  {
    "id": "ENHANCED_ENHANCED-DIAGNOSTIC-003",
    "question": "rtr-core2에서 일부 iBGP 피어가 빠져 경로가 제대로 학습되지 않습니다(원인 가정: iBGP 피어 설정 누락). rtr-core2에서 순서대로 실행할 CLI 명령 3가지를 적어주세요.",
    "context": "BGP 설정 현황:\nCE1: AS65001, 1개 피어\nCE2: AS65003, 1개 피어\nsample10: AS65000, 3개 피어\nsample7: AS65000, 3개 피어\nsample8: AS65000, 3개 피어",
    "ground_truth": [
      "show ip bgp summary",
      "show running-config | section router bgp",
      "show ip bgp"
    ],
    "explanation": "첫 번째 명령어(show ip bgp summary)는 rtr-core2에서 설정된 BGP 피어들의 상태(UP/Idle/Active 등)와 수신/송신된 경로수를 빠르게 확인하기 위해 사용합니다. 두 번째 명령어(show running-config | section router bgp)는 실제로 iBGP 피어가 설정되어 있는지를 확인하고, ASN 또는 neighbor 문구가 누락되었는지, 또는 설정 오류(예: 잘못된 neighbor IP나 update-source 등)가 있는지를 검토하기 위해 사용합니다. 세 번째 명령어(show ip bgp)는 현재 학습된 BGP 경로들을 확인하여 어떤 경로들이 누락되었는지, iBGP로부터 경로가 수신되지 않는지 여부를 확인하기 위해 사용합니다.",
    "answer_type": "short",
    "category": "advanced",
    "complexity": "diagnostic",
    "level": 3,
    "persona": "troubleshooter",
    "scenario": "장애 진단 명령어 시퀀스",
    "source_files": [],
    "metadata": {
      "origin": "enhanced_llm_with_agent",
      "reasoning_plan": [
        {
          "intent": "show_bgp_neighbors",
          "params": {
            "host": "rtr-core2"
          }
        },
        {
          "intent": "show_bgp_summary",
          "params": {
            "host": "rtr-core2"
          }
        },
        {
          "intent": "show_route_table",
          "params": {
            "host": "rtr-core2"
          }
        }
      ],
      "reasoning_requirement": "",
      "expected_analysis_depth": "detailed",
      "evidence": {}
    }
  },
  {
    "id": "ENHANCED_ENHANCED-DIAGNOSTIC-004",
    "question": "rtr-dc1에서 rtr-edge2 방향 L2VPN이 일방향 트래픽만 흐릅니다(원인 가정: VC 상태 불일치). rtr-dc1에서 순서대로 실행할 CLI 명령 3가지를 적어주세요.",
    "context": "총 장비 수: 6 | 사용 기술: BGP, OSPF, L2VPN, L3VPN | AS 번호: 65000, 65001, 65003",
    "ground_truth": [
      "show mpls l2transport vc summary",
      "show mpls l2transport vc <vc-id> detail",
      "clear mpls l2transport vc <vc-id>"
    ],
    "explanation": "첫 번째 명령은 장비에 구성된 모든 L2VPN/VC의 전반적인 상태를 확인하여 어떤 VC가 불일치하거나 문제가 있는지 식별하기 위함입니다. 두 번째 명령은 문제로 의심되는 특정 VC의 상세 상태(로컬/원격 상태, LDP/PW 상태, 제어워드 등)를 확인하여 일방향 트래픽의 원인이 VC 상태 불일치인지 확정하기 위해 사용합니다. 세 번째 명령은 해당 VC를 재설정하여 원격 쪽과의 상태 동기화를 시도하고 PW를 재성립함으로써 일방향 문제를 해결하려는 조치입니다. 실제 실행 시 <vc-id>는 대상 VC의 식별자로 치환하고, 필요하면 rtr-edge2에서도 동일한 상태 확인을 병행해야 합니다.",
    "answer_type": "short",
    "category": "advanced",
    "complexity": "diagnostic",
    "level": 3,
    "persona": "troubleshooter",
    "scenario": "장애 진단 명령어 시퀀스",
    "source_files": [],
    "metadata": {
      "origin": "enhanced_llm_with_agent",
      "reasoning_plan": [
        {
          "intent": "show_l2vpn_vc",
          "params": {
            "host": "rtr-dc1"
          }
        },
        {
          "intent": "show_l2vpn_status",
          "params": {
            "host": "rtr-dc1"
          }
        },
        {
          "intent": "show_interface_status",
          "params": {
            "host": "rtr-dc1",
            "interface": "GigabitEthernet0/1"
          }
        }
      ],
      "reasoning_requirement": "",
      "expected_analysis_depth": "detailed",
      "evidence": {}
    }
  },
  {
    "id": "ENHANCED_ENHANCED-DIAGNOSTIC-005",
    "question": "rtr-dc1에서 rtr-edge1로 연결된 L2VPN이 불안정합니다(원인 가정: PW ID mismatch). rtr-dc1에서 순서대로 실행할 CLI 명령 3가지를 적어주세요.",
    "context": "총 장비 수: 6 | 사용 기술: BGP, OSPF, L2VPN, L3VPN | AS 번호: 65000, 65001, 65003",
    "ground_truth": [
      "show mpls l2transport vc <pw-id> detail",
      "show mpls l2transport vc summary",
      "show running-config | section xconnect"
    ],
    "explanation": "첫 번째 명령인 \"show mpls l2transport vc <pw-id> detail\"은 특정 pseudowire(PW)의 상세 상태를 확인하기 위해 사용합니다. 이 출력에서 로컬/원격 PW ID, 상태(state), 바인딩 정보 및 오류 메시지(예: PW ID mismatch 관련 정보)를 확인할 수 있으므로 문제 원인 추적의 출발점입니다. 두 번째 명령인 \"show mpls l2transport vc summary\"는 모든 L2VPN 가상회선의 요약 상태를 한눈에 보여 주므로 해당 PW의 전반적인 상태(Up/Down, 분포 등)를 빠르게 확인하고 다른 관련 VC의 상태와 비교할 수 있습니다. 세 번째 명령인 \"show running-config | section xconnect\"는 장비에 설정된 xconnect/пseudowire 구성 부분을 검토하여 로컬에 설정된 PW ID가 의도한 값과 일치하는지, 그리고 잘못된 PW ID가 설정되어 있는지 직접 확인할 수 있게 해줍니다. 각 명령에서 얻은 PW ID와 원격 엔드(rtr-edge1)의 구성에 설정된 PW ID를 비교하여 불일치 여부를 확인하면 PW ID mismatch 문제를 확정할 수 있습니다. (명령어의 세부 구문은 장비 벤더/OS에 따라 다를 수 있으므로 필요 시 해당 플랫폼의 동등한 명령을 사용하십시오.)",
    "answer_type": "short",
    "category": "advanced",
    "complexity": "diagnostic",
    "level": 3,
    "persona": "troubleshooter",
    "scenario": "장애 진단 명령어 시퀀스",
    "source_files": [],
    "metadata": {
      "origin": "enhanced_llm_with_agent",
      "reasoning_plan": [
        {
          "intent": "show_l2vpn_vc",
          "params": {
            "host": "rtr-dc1"
          }
        },
        {
          "intent": "show_l2vpn_status",
          "params": {
            "host": "rtr-dc1"
          }
        },
        {
          "intent": "show_log_include",
          "params": {
            "host": "rtr-dc1",
            "string": "l2vpn|pw|pseudowire|pw-id"
          }
        }
      ],
      "reasoning_requirement": "",
      "expected_analysis_depth": "detailed",
      "evidence": {}
    }
  },
  {
    "id": "ENHANCED_ENHANCED-DIAGNOSTIC-006",
    "question": "rtr-core2에서 OSPF area 0 이웃이 DOWN입니다(원인 가정: 인터페이스 다운 또는 area 설정 불일치). rtr-core2에서 순서대로 실행할 CLI 명령 3가지를 적어주세요.",
    "context": "총 장비 수: 6 | 사용 기술: BGP, OSPF, L2VPN, L3VPN | AS 번호: 65000, 65001, 65003",
    "ground_truth": [
      "show ip ospf neighbor",
      "show ip interface brief",
      "show ip ospf interface"
    ],
    "explanation": "첫째로 'show ip ospf neighbor'를 실행하여 어떤 이웃이 DOWN인지, 이웃의 Router ID와 해당 이웃이 사용하던 인터페이스(또는 인터페이스 이름)를 확인합니다. 둘째로 'show ip interface brief'를 실행하여 앞서 확인한 인터페이스의 물리적/관리적 상태(up/down, administratively down, IP 할당 여부 등)를 점검하여 인터페이스 다운 여부를 확인합니다. 셋째로 'show ip ospf interface'를 실행하여 해당 인터페이스에 설정된 OSPF area와 인터페이스별 OSPF 파라미터(Hello/Dead 타이머, 네트워크 타입 등)를 확인함으로써 area 설정 불일치나 OSPF 설정 문제를 진단합니다.",
    "answer_type": "short",
    "category": "advanced",
    "complexity": "diagnostic",
    "level": 3,
    "persona": "troubleshooter",
    "scenario": "장애 진단 명령어 시퀀스",
    "source_files": [],
    "metadata": {
      "origin": "enhanced_llm_with_agent",
      "reasoning_plan": [
        {
          "intent": "show_ip_interface_brief",
          "params": {
            "host": "rtr-core2"
          }
        },
        {
          "intent": "show_ip_ospf_neighbor",
          "params": {
            "host": "rtr-core2"
          }
        },
        {
          "intent": "show_ospf_database",
          "params": {
            "host": "rtr-core2"
          }
        }
      ],
      "reasoning_requirement": "",
      "expected_analysis_depth": "detailed",
      "evidence": {}
    }
  },
  {
    "id": "ENHANCED_ENHANCED-DIAGNOSTIC-007",
    "question": "rtr-edge2에서 특정 네트워크 경로가 보이지 않습니다(원인 가정: OSPF에서 학습되지 않거나 redistribution 누락). rtr-edge2에서 순서대로 실행할 CLI 명령 3가지를 적어주세요.",
    "context": "총 장비 수: 6 | 사용 기술: BGP, OSPF, L2VPN, L3VPN | AS 번호: 65000, 65001, 65003",
    "ground_truth": [
      "show ip route <network>",
      "show ip ospf database",
      "show running-config | section router ospf"
    ],
    "explanation": "첫 번째 명령어인 'show ip route <network>'는 rtr-edge2의 라우팅 테이블에서 해당 네트워크가 실제로 없는지, 있고 나면 그 출처(source)가 무엇인지(OSPF, 연결된, 정적 등)를 확인하기 위해 실행합니다. 두 번째로 'show ip ospf database'를 실행하면 해당 네트워크에 대한 LSA가 OSPF의 LSDB에 존재하는지 확인할 수 있으므로 OSPF로부터 학습되었는지 여부를 판단할 수 있습니다. 세 번째로 'show running-config | section router ospf'는 OSPF 설정과 redistribution 관련 명령이 올바르게 구성되어 있는지(예: redistribute 문이 누락되었는지)를 확인하기 위해 사용합니다. 이 순서는 라우팅 테이블 확인 → OSPF 학습 여부 확인 → 재배포/설정 확인이라는 논리적 진단 흐름을 따릅니다.",
    "answer_type": "short",
    "category": "advanced",
    "complexity": "diagnostic",
    "level": 3,
    "persona": "troubleshooter",
    "scenario": "장애 진단 명령어 시퀀스",
    "source_files": [],
    "metadata": {
      "origin": "enhanced_llm_with_agent",
      "reasoning_plan": [
        {
          "intent": "show_ip_route_ospf",
          "params": {
            "host": "rtr-edge2",
            "prefix": "10.10.0.0/16"
          }
        },
        {
          "intent": "show_route_table",
          "params": {
            "host": "rtr-edge2",
            "prefix": "10.10.0.0/16"
          }
        },
        {
          "intent": "show_bgp_summary",
          "params": {
            "host": "rtr-edge2"
          }
        }
      ],
      "reasoning_requirement": "",
      "expected_analysis_depth": "detailed",
      "evidence": {}
    }
  },
  {
    "id": "ENHANCED_ENHANCED-DIAGNOSTIC-008",
    "question": "rtr-pe1에서 특정 Prefix가 반복적으로 BGP로 플랩합니다(원인 가정: 피어 재설정 또는 next-hop 변경). rtr-pe1에서 순서대로 실행할 CLI 명령 3가지를 적어주세요.",
    "context": "BGP 설정 현황:\nCE1: AS65001, 1개 피어\nCE2: AS65003, 1개 피어\nsample10: AS65000, 3개 피어\nsample7: AS65000, 3개 피어\nsample8: AS65000, 3개 피어",
    "ground_truth": [
      "show ip bgp neighbors <peer-ip> detail",
      "show ip bgp <prefix>",
      "debug ip bgp updates"
    ],
    "explanation": "첫 번째 명령인 \"show ip bgp neighbors <peer-ip> detail\"은 해당 피어와의 BGP 세션 상태, 마지막 리셋 시각 및 리셋 원인(reason/notification), 접속/재접속 카운터와 타이머 등을 확인하기 위해 사용합니다. 피어 재설정이 원인이라면 이 출력에서 연속적인 session reset, hold timer 만료 또는 notification 메시지 기록을 확인할 수 있습니다. 두 번째 명령인 \"show ip bgp <prefix>\"는 해당 Prefix의 현재 BGP 경로 정보(수신된 경로들, best path, next-hop, AS PATH 등)를 보여주어 next-hop 변경이나 경로 선호도 변화로 인해 flap이 발생하는지를 판단하게 해줍니다. 특히 반복적으로 next-hop이 바뀌거나 withdraw/announce가 반복되는지, 다른 피어로부터 다른 경로가 들어오는지 확인해야 합니다. 세 번째 명령인 \"debug ip bgp updates\"는 실시간으로 BGP 업데이트(announce/withdraw)를 캡처하여 플랩이 발생하는 정확한 타이밍과 원인을 파악하는 데 사용합니다. 다만 디버그는 CPU 부하를 유발할 수 있으므로 필요한 기간 동안만 실행하고, 콘솔/로그로 결과를 수집한 뒤 즉시 디버그를 취소해야 합니다.",
    "answer_type": "short",
    "category": "advanced",
    "complexity": "diagnostic",
    "level": 3,
    "persona": "troubleshooter",
    "scenario": "장애 진단 명령어 시퀀스",
    "source_files": [],
    "metadata": {
      "origin": "enhanced_llm_with_agent",
      "reasoning_plan": [
        {
          "intent": "show_bgp_neighbors",
          "params": {
            "host": "rtr-pe1"
          }
        },
        {
          "intent": "show_bgp_neighbor_detail",
          "params": {
            "host": "rtr-pe1",
            "neighbor_ip": "198.51.100.2"
          }
        },
        {
          "intent": "show_route_table",
          "params": {
            "host": "rtr-pe1",
            "prefix": "192.0.2.0/24"
          }
        }
      ],
      "reasoning_requirement": "",
      "expected_analysis_depth": "detailed",
      "evidence": {}
    }
  },
  {
    "id": "ENHANCED_ENHANCED-DIAGNOSTIC-009",
    "question": "rtr-edge1의 VRF 'vpn-blue'에서 목적지로의 경로가 보이지 않습니다(원인 가정: VRF-인터페이스 바인딩 누락 또는 라우트 미설치). rtr-edge1에서 순서대로 실행할 CLI 명령 3가지를 적어주세요.",
    "context": "VRF 설정 현황:\nsample10: 1개 VRF (exam-l3vpn)\nsample7: 1개 VRF (exam-l3vpn)\nsample8: 1개 VRF (exam-l3vpn)\nsample9: 1개 VRF (exam-l3vpn)",
    "ground_truth": [
      "show ip vrf vpn-blue",
      "show running-config | include ip vrf forwarding",
      "show ip route vrf vpn-blue"
    ],
    "explanation": "첫 번째 명령어는 VRF 'vpn-blue'가 장비에 존재하는지와 해당 VRF에 바인딩된 인터페이스(출력에 표시되는 경우), RD/RT 등의 기본 정보를 확인하기 위해 사용합니다. 두 번째 명령어는 런닝 구성에서 'ip vrf forwarding vpn-blue' 설정이 실제로 어떤 인터페이스에 적용되어 있는지 빠르게 찾아 VRF-인터페이스 바인딩 누락 여부를 직접 확인하기 위해 사용합니다. 세 번째 명령어는 해당 VRF의 라우팅 테이블에서 목적지 네트워크가 설치되어 있는지 여부를 확인하기 위해 사용하며, 경로가 보이지 않으면 라우트가 미설치이거나 라우팅 프로토콜이 해당 VRF에서 경로를 학습하지 못한 문제임을 시사합니다.",
    "answer_type": "short",
    "category": "advanced",
    "complexity": "diagnostic",
    "level": 3,
    "persona": "troubleshooter",
    "scenario": "장애 진단 명령어 시퀀스",
    "source_files": [],
    "metadata": {
      "origin": "enhanced_llm_with_agent",
      "reasoning_plan": [
        {
          "intent": "show_vrf",
          "params": {
            "host": "rtr-edge1",
            "vrf": "vpn-blue"
          }
        },
        {
          "intent": "show_ip_interface_brief",
          "params": {
            "host": "rtr-edge1"
          }
        },
        {
          "intent": "show_route_table",
          "params": {
            "host": "rtr-edge1",
            "vrf": "vpn-blue"
          }
        }
      ],
      "reasoning_requirement": "",
      "expected_analysis_depth": "detailed",
      "evidence": {}
    }
  },
  {
    "id": "ENHANCED_ENHANCED-DIAGNOSTIC-010",
    "question": "rtr-core1에 SSH 접속이 실패합니다(원인 가정: vty ACL에 의한 차단). rtr-core1에서 순서대로 실행할 CLI 명령 3가지를 적어주세요.",
    "context": "보안 설정 현황:\nCE1: SSH ON, AAA OFF\nCE2: SSH ON, AAA OFF\nsample10: SSH ON, AAA ON\nsample7: SSH ON, AAA ON\nsample8: SSH ON, AAA ON",
    "ground_truth": [
      "show running-config | section line vty",
      "show ip access-lists <acl-name>",
      "show ssh"
    ],
    "explanation": "First, run 'show running-config | section line vty' to see the configuration of the VTY lines on rtr-core1; this will reveal whether an access-class is applied to the vty lines (for example 'access-class <acl-name> in') and also show transport input (ssh/telnet) settings. Second, run 'show ip access-lists <acl-name>' to inspect the actual ACL referenced by the vty lines: check the permit/deny entries, sequence/order, and packet hit counters to determine whether traffic from the SSH client's source IP is being denied by the ACL. Third, run 'show ssh' to verify the SSH server state on the router (enabled version, active sessions, and session counts) to rule out SSH service issues; combining the VTY configuration, the ACL contents/counters, and the SSH service status will confirm whether the vty ACL is the cause of the SSH connection failure.",
    "answer_type": "short",
    "category": "advanced",
    "complexity": "diagnostic",
    "level": 3,
    "persona": "troubleshooter",
    "scenario": "장애 진단 명령어 시퀀스",
    "source_files": [],
    "metadata": {
      "origin": "enhanced_llm_with_agent",
      "reasoning_plan": [
        {
          "intent": "show_logging",
          "params": {
            "host": "rtr-core1",
            "lines": 200
          }
        },
        {
          "intent": "show_log_include",
          "params": {
            "host": "rtr-core1",
            "string": "SSH|vty|login|authentication"
          }
        },
        {
          "intent": "check_connectivity",
          "params": {
            "host": "rtr-core1",
            "target": "198.51.100.10"
          }
        }
      ],
      "reasoning_requirement": "",
      "expected_analysis_depth": "detailed",
      "evidence": {}
    }
  }
]